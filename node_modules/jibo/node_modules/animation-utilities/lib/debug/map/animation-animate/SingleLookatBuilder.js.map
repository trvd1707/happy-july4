{"version":3,"sources":["animation-animate/SingleLookatBuilder.js"],"names":[],"mappings":"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","file":"animation-animate/SingleLookatBuilder.js","sourcesContent":["/**\n * @author jg\n */\n\n\"use strict\";\n\nvar MotionLookat = require(\"../ifr-motion/lookat/MotionLookat\");\nvar LookatNode = require(\"../ifr-motion/lookat/LookatNode\");\nvar LookatMotionNode = require(\"../ifr-motion/lookat/LookatMotionNode\");\nvar RotationalLookatDOF = require(\"../ifr-motion/lookat/RotationalLookatDOF\");\nvar RotationalPlaneAlignmentLookatDOF = require(\"../ifr-motion/lookat/RotationalPlaneAlignmentLookatDOF\");\nvar PlaneDisplacementLookatDOF = require(\"../ifr-motion/lookat/PlaneDisplacementLookatDOF\");\nvar Pose = require(\"../ifr-motion/base/Pose\");\nvar Motion = require(\"../ifr-motion/base/Motion\");\nvar THREE = require(\"three\");\nvar SimpleMotionGenerator = require(\"./timeline/SimpleMotionGenerator\");\nvar slog = require(\"../ifr-core/SLog\");\nvar LookatMultiLayerStatusManager = require(\"./timeline/LookatMultiLayerStatusManager\");\nvar DOFSet = require(\"../geometry-info/DOFSet\");\nvar LookatNodeTrackPolicy = require(\"../ifr-motion/lookat/trackpolicy/LookatNodeTrackPolicy\");\nvar TrackPolicyTriggerAlways = require(\"../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerAlways\");\nvar TrackPolicyTriggerDiscomfort = require(\"../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerDiscomfort\");\nvar TrackPolicyTriggerMovementTerminated = require(\"../ifr-motion/lookat/trackpolicy/TrackPolicyTriggerMovementTerminated\");\n\nvar channel = \"LOOKAT\";\n\n/**\n * @callback LookatEventCallback\n * @param {string} eventName\n * @param {LookatInstance} lookatInstance - lookat instance that generated this event\n * @private\n */\n\n/**\n * Enum Values for lookat builder event types.\n * @enum {string}\n * @private\n */\nvar LookatEventType = { //TODO: reference these (from where?) instead of recreating them here?\n\tSTARTED: \"STARTED\",\n\tTARGET_REACHED: \"TARGET_REACHED\", //reported when look has reached target\n\tTARGET_SUPERSEDED: \"TARGET_SUPERSEDED\", //reported when look given new target before reaching previous\n\n\t/**\n\t * reported when look stops; check interrupted boolean description property\n\t * (interrupted is true if look stopped without reaching target)\n\t */\n\tSTOPPED: \"STOPPED\",\n\tCANCELLED: \"CANCELLED\" //will not start\n};\n\n/**\n * @param {number} acceleration\n * @param {number} velocity\n * @param {number} [TPTDLimitInner]\n * @param {number} [TPTDLimitOuter]\n * @param {number} [TPTDAccumInner]\n * @param {number} [TPTDAccumOuter]\n * @param {boolean} [TPTDMoveImmediatelyPastOuter]\n * @param {number} [TPTMTDeadZone]\n * @param {number} [TPTMTDeadTime]\n * @constructor\n */\nvar LookatNodeRuntimeConfig = function(velocity, acceleration,\n\t\t\t\t\t\t\t\t\t\tTPTDLimitInner, TPTDLimitOuter, TPTDAccumInner, TPTDAccumOuter, TPTDMoveImmediatelyPastOuter,\n\t\t\t\t\t\t\t\t\t\tTPTMTDeadZone, TPTMTDeadTime){\n\t/** @type {number} */\n\tthis.velocity = velocity;\n\t/** @type {number} */\n\tthis.acceleration = acceleration;\n\t/** @type {number} */\n\tthis.TPTDLimitInner = TPTDLimitInner;\n\t/** @type {number} */\n\tthis.TPTDLimitOuter = TPTDLimitOuter;\n\t/** @type {number} */\n\tthis.TPTDAccumInner = TPTDAccumInner;\n\t/** @type {number} */\n\tthis.TPTDAccumOuter = TPTDAccumOuter;\n\t/** @type {boolean} */\n\tthis.TPTDMoveImmediatelyPastOuter = TPTDMoveImmediatelyPastOuter;\n\n\t/** @type {number} */\n\tthis.TPTMTDeadZone = TPTMTDeadZone;\n\t/** @type {number} */\n\tthis.TPTMTDeadTime = TPTMTDeadTime;\n\n};\n\n/**\n * @param {number} min\n * @param {number} max\n * @constructor\n */\nvar LookatDOFRuntimeConfig = function(min, max){\n\t/** @type {number} */\n\tthis.min = min;\n\t/** @type {number} */\n\tthis.max = max;\n};\n\n\n/**\n *\n * @param {MotionTimeline} timeline\n * @param {RobotInfo} robotInfo\n * @param {TransitionBuilder} transition\n * @constructor\n * @private\n */\nvar SingleLookatBuilder = function(timeline, robotInfo, transition){ // eslint-disable-line no-unused-vars\n\n\tvar self = this;\n\n\t/** @type {Object.<string,LookatNodeRuntimeConfig>} */\n\tvar lookatNodeRuntimeConfigs = {\n\t\t//BaseLookatNode:new LookatNodeRuntimeConfig(null, 3, 0.1, 0.9, 0.2, 3, true, 0.1, 0.05),\n\t\tBaseLookatNode:new LookatNodeRuntimeConfig(null, 3),\n\t\tTorsoLookatNode:new LookatNodeRuntimeConfig(null, 3),\n\t\tTopLookatNode:new LookatNodeRuntimeConfig(null, 3),\n\t\tEye:new LookatNodeRuntimeConfig(null, 1)\n\t};\n\n\t/** @type {Object.<string,LookatDOFRuntimeConfig>} */\n\tvar lookatDOFRuntimeConfigs = {\n\t\tbottomSection_r:new LookatDOFRuntimeConfig(null, null),\n\t\tmiddleSection_r:new LookatDOFRuntimeConfig(null, null),\n\t\ttopSection_r:new LookatDOFRuntimeConfig(null, null),\n\t\teyeSubRootBn_t:new LookatDOFRuntimeConfig(-0.0364357400, 0.0364357400),\n\t\teyeSubRootBn_t_2:new LookatDOFRuntimeConfig(-0.0080087240, 0.0080087240)\n\t};\n\n\t/**\n\t *\n\t * @param {LookatNodeRuntimeConfig} config\n\t */\n\tvar getTrackPolicy = function(config){\n\t\tif(config.TPTDLimitInner != null){\n\t\t\t//assume all present if any present\n\t\t\treturn new LookatNodeTrackPolicy([\n\t\t\t\tnew TrackPolicyTriggerDiscomfort(config.TPTDLimitInner, config.TPTDLimitOuter, config.TPTDAccumInner, config.TPTDAccumOuter, config.TPTDMoveImmediatelyPastOuter),\n\t\t\t\tnew TrackPolicyTriggerMovementTerminated(config.TPTMTDeadZone, config.TPTMTDeadTime)\n\t\t\t]);\n\t\t}else{\n\t\t\treturn new LookatNodeTrackPolicy([new TrackPolicyTriggerAlways()]);\n\t\t}\n\t};\n\n\t/**\n\t * @return {MotionLookat}\n\t */\n\tvar initLookat = function(){\n\t\t/** @type {KinematicGroup} */\n\t\tvar kinematicGroupProto = robotInfo.getKinematicInfo().getFullKinematicGroup();\n\n\t\treturn new MotionLookat([\n\t\t\tnew LookatMotionNode(new LookatNode(\"BaseLookatNode\", [\n\t\t\t\tnew RotationalLookatDOF(\n\t\t\t\t\t\"BaseLookatDOF\",\n\t\t\t\t\t\"bottomSection_r\",\n\t\t\t\t\tnew THREE.Vector3(0, 0, -1)\n\t\t\t\t)\n\t\t\t]), robotInfo.getKinematicInfo().getDOFGlobalAlignment(),\n\t\t\t\tlookatNodeRuntimeConfigs[\"BaseLookatNode\"].acceleration,\n\t\t\t\tLookatMotionNode.LookStabilizationMode.POINT_AUTO,\n\t\t\t\tgetTrackPolicy(lookatNodeRuntimeConfigs[\"BaseLookatNode\"])),\n\t\t\tnew LookatMotionNode(new LookatNode(\"TorsoLookatNode\", [\n\t\t\t\tnew RotationalPlaneAlignmentLookatDOF(\n\t\t\t\t\t\"TorsoLookatDOF\",\n\t\t\t\t\t\"middleSection_r\",\n\t\t\t\t\tnew THREE.Vector3(9.509979E-9, 0.9271838, 0.37460676),\n\t\t\t\t\t0.18703285,\n\t\t\t\t\t0.29670632\n\t\t\t\t)\n\t\t\t]), robotInfo.getKinematicInfo().getDOFGlobalAlignment(),\n\t\t\t\tlookatNodeRuntimeConfigs[\"TorsoLookatNode\"].acceleration,\n\t\t\t\tLookatMotionNode.LookStabilizationMode.POINT_AUTO,\n\t\t\t\tnew getTrackPolicy(lookatNodeRuntimeConfigs[\"TorsoLookatNode\"])),\n\t\t\tnew LookatMotionNode(new LookatNode(\"TopLookatNode\", [\n\t\t\t\tnew RotationalLookatDOF(\n\t\t\t\t\t\"TopLookatDOF\",\n\t\t\t\t\t\"topSection_r\",\n\t\t\t\t\tnew THREE.Vector3(0, 0, -1)\n\t\t\t\t)\n\t\t\t]), robotInfo.getKinematicInfo().getDOFGlobalAlignment(),\n\t\t\t\tlookatNodeRuntimeConfigs[\"TopLookatNode\"].acceleration,\n\t\t\t\tLookatMotionNode.LookStabilizationMode.POINT_AUTO,\n\t\t\t\tgetTrackPolicy(lookatNodeRuntimeConfigs[\"TopLookatNode\"])),\n\t\t\tnew LookatMotionNode(new LookatNode(\"Eye\",[\n\t\t\t\tnew PlaneDisplacementLookatDOF(\n\t\t\t\t\t\"EyeLeftRight\",\n\t\t\t\t\t\"eyeSubRootBn_t\",\n\t\t\t\t\t\"eyeRootBn\",\n\t\t\t\t\tnew THREE.Vector3(0,0,1),\n\t\t\t\t\tnew THREE.Vector3(0,1,0),\n\t\t\t\t\t20/100,\n\t\t\t\t\tlookatDOFRuntimeConfigs[\"eyeSubRootBn_t\"].min,\n\t\t\t\t\tlookatDOFRuntimeConfigs[\"eyeSubRootBn_t\"].max\n\t\t\t\t),\n\t\t\t\tnew PlaneDisplacementLookatDOF(\n\t\t\t\t\t\"EyeUpDown\",\n\t\t\t\t\t\"eyeSubRootBn_t_2\",\n\t\t\t\t\t\"eyeRootBn\",\n\t\t\t\t\tnew THREE.Vector3(0,0,1),\n\t\t\t\t\tnew THREE.Vector3(-1,0,0),\n\t\t\t\t\t10/100,\n\t\t\t\t\tlookatDOFRuntimeConfigs[\"eyeSubRootBn_t_2\"].min,\n\t\t\t\t\tlookatDOFRuntimeConfigs[\"eyeSubRootBn_t_2\"].max\n\t\t\t\t)\n\t\t\t]), robotInfo.getKinematicInfo().getDOFGlobalAlignment(),\n\t\t\t\tlookatNodeRuntimeConfigs[\"Eye\"].acceleration,\n\t\t\t\tLookatMotionNode.LookStabilizationMode.POINT_TARGET,\n\t\t\t\tgetTrackPolicy(lookatNodeRuntimeConfigs[\"Eye\"]))\n\n\t\t], kinematicGroupProto);\n\t};\n\n\tvar shouldOrientFully = true;\n\tvar continuous = false;\n\n\t/** @type {Object<LookatEventType,LookatEventCallback[]>} */\n\tvar eventHandlers = {};\n\n\t/** @type {MotionLookat} */\n\tvar lookat = initLookat();\n\n\t/** @type {Pose} */\n\tvar lookPose = new Pose(\"LookPose\", lookat.getDOFs());\n\n\n\t/**\n\t * @param {THREE.Vector3} target\n\t * @param {MotionLookat} lookat\n\t * @constructor\n\t * @private\n\t */\n\tvar LookatInstance = function(target, lookat, multiTargetStatus){\n\t\ttarget = target.clone(); //make sure we have a cached copy\n\t\t/** @type {LookatMotionGenerator} */\n\t\tvar mainLayerClip = null;\n\t\t/** @type {LookatMotionGenerator} */\n\t\tvar lookatLayerClip = null;\n\t\t/** @type {LookatMultiLayerStatusManager} */\n\t\tvar statusManager = multiTargetStatus;\n\n\t\tthis.getTarget = function(){\n\t\t\treturn target;\n\t\t};\n\n\t\t/**\n\t\t * @param {THREE.Vector3|number[]} newTarget\n\t\t */\n\t\tthis.updateTarget = function(newTarget)\n\t\t{\n\t\t\tif(Array.isArray(newTarget)){\n\t\t\t\ttarget.set(newTarget[0], newTarget[1], newTarget[2]);\n\t\t\t}else{\n\t\t\t\ttarget.copy(newTarget);\n\t\t\t}\n\t\t\tstatusManager.setTarget(target);\n\t\t};\n\n\t\tthis.getBuilder = function(){\n\t\t\treturn self;\n\t\t};\n\n\t\tthis.setClip = function(useMainClip, useLookatClip){\n\t\t\tmainLayerClip = useMainClip;\n\t\t\tlookatLayerClip = useLookatClip;\n\t\t};\n\n\t\tthis.stop = function(){\n\t\t\tif (mainLayerClip)\n\t\t\t{\n\t\t\t\tstopClip(mainLayerClip, \"default\");\n\t\t\t}\n\t\t\tif (lookatLayerClip)\n\t\t\t{\n\t\t\t\tstopClip(lookatLayerClip, \"lookat\");\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {MotionGenerator} clip\n\t\t * @param {string} layer\n\t\t */\n\t\tvar stopClip = function(clip, layer){\n\t\t\t//find the soonest time we have not yet committed to\n\t\t\t//TODO: this is sometimes overly conservative:\n\t\t\t// in some edge cases dofs still in the clips may not be using their whole commitment window\n\t\t\tvar reactionTime = 0;\n\t\t\t//TODO: reactionTime\n\t\t\t//if(!clip.hasExited()){\n\t\t\t//\treactionTime = timeline.getReactionTime(\"MOTION\", clip.getMotion());\n\t\t\t//}\n\n\t\t\t//this is the earliest we could stop for the related dofs (aside from conservative consideration above)\n\t\t\t/** @type {Time} */\n\t\t\tvar stopTime = timeline.getClock().currentTime().add(reactionTime);\n\n\t\t\t//also, if all clips are fully committed, we will not stop\n\t\t\tif(stopTime.isGreater(clip.getEndTime())){\n\t\t\t\t//stopTime is after clip is already over; cannot stop.  do nothing.\n\t\t\t\tif(clip.hasExited()) {\n\t\t\t\t\tslog.info(\"Ignoring stop on SingleLookat as it is already over\");\n\t\t\t\t}else{\n\t\t\t\t\tslog.info(\"Ignoring stop on SingleLookat as it is already committed\");\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//however we will not stop before any of the clips start!\n\t\t\tif(clip.getStartTime().isGreater(stopTime)){\n\t\t\t\tstopTime = clip.getStartTime();\n\t\t\t\tslog.info(\"Stopping called on lookat before it started, moving stopTime forward\");\n\t\t\t}\n\n\t\t\t/** @type {string[]} */\n\t\t\tvar dofsToStop = [];\n\n\t\t\t/** @type {string[]} */\n\t\t\tvar possibleDOFs = clip.getDOFs();\n\n\t\t\tvar deltaToStopForClip = stopTime.subtract(clip.getStartTime());\n\n\t\t\tfor(var i = 0; i < possibleDOFs.length; i++){\n\t\t\t\tvar durationForDOF = clip.getDurationForDOF(possibleDOFs[i]);\n\t\t\t\tif(durationForDOF!==null && durationForDOF > deltaToStopForClip){\n\t\t\t\t\tdofsToStop.push(possibleDOFs[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//TODO: using zero-duration motion for now, might want to add explicit timeline stop() method\n\n\t\t\t/** @type {Pose} */\n\t\t\tvar stopPose = new Pose(\"stop pose\", dofsToStop);\n\t\t\tfor(var d = 0; d < dofsToStop.length; d++){\n\t\t\t\tstopPose.set(dofsToStop[d], [0]);\n\t\t\t}\n\n\t\t\t/** @type {Motion} */\n\t\t\tvar stopMotion = Motion.createFromPose(clip.getName()+\"_stop\", stopPose, 0);\n\t\t\tvar stopClip = new SimpleMotionGenerator(stopMotion, stopTime, robotInfo);\n\t\t\ttimeline.add(stopClip, layer);\n\t\t};\n\t};\n\n\t/**\n\t * @param {THREE.Vector3|number[]} target\n\t * @return {LookatInstance}\n\t */\n\tthis.startLookat = function(targetArg){\n\t\t/** @type {THREE.Vector3} */\n\t\tvar target = null;\n\t\tif(Array.isArray(targetArg)){\n\t\t\ttarget = new THREE.Vector3(targetArg[0], targetArg[1], targetArg[2]);\n\t\t}else{\n\t\t\ttarget = targetArg;\n\t\t}\n\n\t\t//var delay = (delayLookatStart !== undefined) ? delayLookatStart : 0;\n\t\t//var reactionTime = timeline.getReactionTime(animate.MODALITY_NAME, m);\n\t\t//var reactionTime = timeline.getReactionTime(\"MOTION\", m);\n\t\t//delay = Math.max(delay, reactionTime);\n\t\tvar startTime = timeline.getClock().currentTime();\n\n\t\tlookat = initLookat();\n\n\t\tvar lookatLayerPose = timeline.getCurrentState([\"lookat\"]).getPose();\n\t\tvar defaultLayerDOFs = [];\n\t\tvar lookatLayerDOFs = [];\n\t\tvar allLookDOFs = lookPose.getDOFNames();\n\t\tfor (var i=0; i<allLookDOFs.length; i++)\n\t\t{\n\t\t\tif (lookatLayerPose.get(allLookDOFs[i]) !== null)\n\t\t\t{\n\t\t\t\tlookatLayerDOFs.push(allLookDOFs[i]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdefaultLayerDOFs.push(allLookDOFs[i]);\n\t\t\t}\n\t\t}\n\n\t\tvar currentLayerState = timeline.getCurrentState([\"default\", \"lookat\"]);\n\t\t/** @type{Pose} */\n\t\t//var currentPose = timeline.getStateAtTime(animate.MODALITY_NAME, startTime);\n\t\t// transition from: the current \"absolute\" pose (combination of default and lookat layers)\n\t\tvar currentPose = currentLayerState.getPose();\n\t\t/** @type{Time} */\n\t\tvar currentPoseTime = currentLayerState.getTime();\n\n\t\t/** @type {MotionGenerator} */\n\t\tvar timelineClip = null;\n\t\t///** @type {BaseMotionGenerator} */\n\t\t//var lookatStaticLayerClip;\n\n\t\t/** @type {LookatMultiLayerStatusManager} */\n\t\tvar layersStatusManager = new LookatMultiLayerStatusManager(lookat, startTime, target, continuous);\n\n\t\tvar preRender = false;\n\n\t\tif(preRender) {\n\t\t\tlookat.reset();\n\t\t\t//var startTime = Clock.currentTime();\n\t\t\tvar time = startTime;\n\t\t\tvar poses = [];\n\t\t\tvar times = [];\n\t\t\tvar remainingDistance = Number.MAX_VALUE;\n\n\t\t\twhile (remainingDistance > 0.001) {\n\t\t\t\tslog(channel, \"Creating lookat pose at time \" + time.subtract(startTime) + \" with remaining:\" + remainingDistance);\n\t\t\t\tlookat.generatePose(currentPose, lookPose, target, time);\n\t\t\t\tremainingDistance = lookat.getDistanceRemaining();\n\t\t\t\tvar p = new Pose(\"Pose \" + time, lookPose.getDOFNames());\n\t\t\t\tp.setPose(lookPose);\n\t\t\t\tposes.push(p);\n\t\t\t\ttimes.push(time.subtract(startTime));\n\t\t\t\tcurrentPose.setPose(lookPose);\n\t\t\t\ttime = time.add(1 / 30.0);\n\t\t\t}\n\n\t\t\tvar lookRenderedMotion = Motion.createFromPoses(\"ToLook\", poses, times, time.subtract(startTime));\n\n\t\t\ttimelineClip = new SimpleMotionGenerator(lookRenderedMotion, startTime, robotInfo);\n\n\t\t\t//if (lookatLayerDOFs.length > 0) {\n\t\t\t//\tvar preRenderedLookatStaticLayerMotion = Motion.createFromPose(\"lookat target static\", poses[poses.length - 1], lookRenderedMotion.getDuration(), lookatLayerDOFs);\n\t\t\t//\tlookatStaticLayerClip = new SimpleMotionGenerator(preRenderedLookatStaticLayerMotion, startTime, robotInfo);\n\t\t\t//}\n\t\t}else{\n\t\t\t/////initialize the lookat with the current state///////\n\t\t\tlookat.reset();\n\t\t\tif (shouldOrientFully){\n\t\t\t\tlookat.generatePose(currentPose, lookPose, target, currentPoseTime);\n\t\t\t}else{\n\t\t\t\tfor (i=0; i<lookatLayerDOFs.length; i++)\n\t\t\t\t{\n\t\t\t\t\tlookat.generatePoseIncremental(lookatLayerPose, lookPose, target, currentPoseTime, lookatLayerDOFs[i]);\n\t\t\t\t}\n\t\t\t\tfor (i=0; i<defaultLayerDOFs.length; i++)\n\t\t\t\t{\n\t\t\t\t\tlookat.generatePoseIncremental(currentPose, lookPose, target, currentPoseTime, defaultLayerDOFs[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t/////////////////      done init        ////////////////\n\n\t\t\ttimelineClip = layersStatusManager.createGenerator(defaultLayerDOFs);\n\n\n\t\t\t//if (lookatLayerDOFs.length > 0) {\n\t\t\t//\tlookat.getOptimalPose(currentPose, lookPose, target);\n\t\t\t//\tvar activeLookatStaticLayerMotion = Motion.createFromPose(\"lookat target static\", lookPose, Number.MAX_VALUE, lookatLayerDOFs);\n\t\t\t//\tlookatStaticLayerClip = new SimpleMotionGenerator(activeLookatStaticLayerMotion, startTime, robotInfo);\n\t\t\t//}\n\t\t}\n\n\t\t/** @type {LookatInstance} */\n\t\tvar lookatInstance = new LookatInstance(target, lookat, layersStatusManager);\n\n\t\tlayersStatusManager.setHandlers(\n\t\t\tcreateStartedHandler(lookatInstance), createStoppedHandler(lookatInstance), createRemovedHandler(lookatInstance),\n\t\t\tcreateTargetReachedHandler(lookatInstance), createTargetSupersededHandler(lookatInstance)\n\t\t);\n\n\t\t// add the full lookat transition to the default layer\n\t\ttimelineClip = timeline.add(timelineClip, \"default\");\n\n\t\tvar lookLayerGenerator = null;\n\t\tif (lookatLayerDOFs.length > 0)\n\t\t{\n\t\t\t// add the static target lookat pose to the lookat layer, for future additive blending\n\t\t\t//timeline.add(lookatStaticLayerClip, \"lookat\");\n\n\t\t\tif (shouldOrientFully)\n\t\t\t{\n\t\t\t\tvar zeroMotion = Motion.createFromPose(\"zero motion\", robotInfo.getKinematicInfo().getDefaultPose().getCopy(), 1.0, lookatLayerDOFs);\n\t\t\t\ttimeline.add(new SimpleMotionGenerator(zeroMotion, startTime, robotInfo, lookatLayerDOFs), \"default\");\n\t\t\t}\n\n\t\t\tlookLayerGenerator = layersStatusManager.createGenerator(lookatLayerDOFs);\n\t\t\ttimeline.add(lookLayerGenerator, \"lookat\");\n\t\t}\n\n\t\tlookatInstance.setClip(timelineClip, lookLayerGenerator);\n\n\t\treturn lookatInstance;\n\t};\n\n\t/**\n\t * Register an event listener\n\t * @param {LookatEventType} eventName\n\t * @param {LookatEventCallback} callback\n\t */\n\tthis.on = function(eventName, callback){\n\t\t/** @type {LookatEventCallback[]} */\n\t\tvar handlersForType = eventHandlers[eventName];\n\t\tif(!handlersForType){\n\t\t\thandlersForType = [];\n\t\t\teventHandlers[eventName] = handlersForType;\n\t\t}\n\t\tif(handlersForType.indexOf(callback)===-1){\n\t\t\thandlersForType.push(callback);\n\t\t}\n\t};\n\n\t/**\n\t * Un-register an event listener\n\t * @param {LookatEventType} eventName\n\t * @param {LookatEventCallback} callback\n\t */\n\tthis.off = function(eventName, callback){\n\t\t/** @type {LookatEventCallback[]} */\n\t\tvar handlersForType = eventHandlers[eventName];\n\t\tif(handlersForType){\n\t\t\tvar index = handlersForType.indexOf(callback);\n\t\t\tif(index!==-1){\n\t\t\t\thandlersForType.splice(index, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Set the DOFs to be used in the look-at/orient behavior.\n\t *\n\t * Commonly-used dof groups are defined in [animate.dofs]{@link module:jibo/animate.dofs}.\n\t *\n\t * @param {DOFSet|string[]} dofNames - names of dofs to use, null for all dofs.\n\t */\n\tthis.setDOFs = function(dofNames){\n\t\tif (!dofNames)\n\t\t{\n\t\t\tdofNames = lookat.getDOFs();\n\t\t}\n\t\telse if (dofNames instanceof DOFSet)\n\t\t{\n\t\t\tdofNames = dofNames.getDOFs();\n\t\t}\n\t\tvar validDOFs = lookat.getDOFs();\n\t\tvar newDOFs = [];\n\t\tfor (var i=0; i<dofNames.length; i++)\n\t\t{\n\t\t\tif (validDOFs.indexOf(dofNames[i]) > -1)\n\t\t\t{\n\t\t\t\tnewDOFs.push(dofNames[i]);\n\t\t\t}\n\t\t}\n\t\tlookPose = new Pose(\"LookPose\", newDOFs);\n\t};\n\n\t/**\n\t * @return {string[]}\n\t */\n\tthis.getDOFs = function(){\n\t\treturn lookPose.getDOFNames().slice(0);\n\t};\n\n\t/**\n\t * @param {boolean} orientFully\n\t */\n\tthis.setOrientFully = function(orientFully){\n\t\tshouldOrientFully = orientFully;\n\t};\n\n\t/**\n\t * @param {boolean} isContinuous\n\t */\n\tthis.setContinuousMode = function(isContinuous){\n\t\tcontinuous = isContinuous;\n\t};\n\n\t/**\n\t * @param {TransitionBuilder} transition\n\t */\n\tthis.setTransitionIn = function(newTransition){\n\t\t//TODO: cache for instances?\n\t\ttransition = newTransition;\n\t};\n\n\t/**\n\t * Get the config for a single lookat node.  Returned object is not a copy (subsequent modifications will affect this builder)\n\t * @param {string} nodeName\n\t * @return {LookatNodeRuntimeConfig}\n\t */\n\tthis.getLookatNodeConfig = function(nodeName){\n\t\tif(!lookatNodeRuntimeConfigs.hasOwnProperty(nodeName)){\n\t\t\tthrow new Error(\"Cannot get config for unknown node: \"+nodeName+\" (valid nodes:\"+Object.keys(lookatNodeRuntimeConfigs)+\")\");\n\t\t}else{\n\t\t\treturn lookatNodeRuntimeConfigs[nodeName];\n\t\t}\n\t};\n\n\t/**\n\t * Set the config for a single lookat node.  Object is not a copied (subsequent modifications will affect this builder)\n\t * @param {string} nodeName\n\t * @param {LookatDOFRuntimeConfig} config\n\t */\n\tthis.setLookatNodeConfig = function(nodeName, config){\n\t\tif(!lookatNodeRuntimeConfigs.hasOwnProperty(nodeName)){\n\t\t\tthrow new Error(\"Cannot set config for unknown node: \"+nodeName+\" (valid nodes:\"+Object.keys(lookatNodeRuntimeConfigs)+\")\");\n\t\t}else{\n\t\t\tlookatNodeRuntimeConfigs[nodeName] = config;\n\t\t}\n\t};\n\n\t/**\n\t * Get the config for a single lookat dof.  Returned object is not a copy (subsequent modifications will affect this builder)\n\t * @param {string} dofName\n\t * @return {LookatDOFRuntimeConfig}\n\t */\n\tthis.getLookatDOFConfig = function(dofName){\n\t\tif(!lookatDOFRuntimeConfigs.hasOwnProperty(dofName)){\n\t\t\tthrow new Error(\"Cannot get config for unknown DOF: \"+dofName+\" (valid DOFS:\"+Object.keys(lookatDOFRuntimeConfigs)+\")\");\n\t\t}else{\n\t\t\treturn lookatDOFRuntimeConfigs[dofName];\n\t\t}\n\t};\n\n\t/**\n\t * Set the config for a single lookat dof.  Object is not a copied (subsequent modifications will affect this builder)\n\t * @param {string} dofName\n\t * @param {LookatDOFRuntimeConfig} config\n\t */\n\tthis.setLookatDOFConfig = function(dofName, config){\n\t\tif(!lookatDOFRuntimeConfigs.hasOwnProperty(dofName)){\n\t\t\tthrow new Error(\"Cannot set config for unknown DOF: \"+dofName+\" (valid DOFS:\"+Object.keys(lookatDOFRuntimeConfigs)+\")\");\n\t\t}else{\n\t\t\tlookatDOFRuntimeConfigs[dofName] = config;\n\t\t}\n\t};\n\n\n\n\t//var createImmediateSuccessHandler = function(lookatInstance){\n\t//\tvar hStarted = eventHandlers[LookatEventType.STARTED];\n\t//\tvar hStopped = eventHandlers[LookatEventType.STOPPED];\n\t//\tvar hTargetReached = eventHandlers[LookatEventType.TARGET_REACHED];\n\t//\tif(hStarted || hStopped || hTargetReached){\n\t//\t\tvar startHandlers = null;\n\t//\t\tvar targetReachedHandlers = null;\n\t//\t\tvar stopHandlers = null;\n\t//\t\tvar i;\n\t//\t\tif(hStarted) {\n\t//\t\t\tstartHandlers = hStarted.slice(0);\n\t//\t\t}\n\t//\t\tif(hStopped) {\n\t//\t\t\tstopHandlers = hStopped.slice(0);\n\t//\t\t}\n\t//\t\tif(hTargetReached) {\n\t//\t\t\ttargetReachedHandlers = hTargetReached.slice(0);\n\t//\t\t}\n\t//\n\t//\t\treturn function() {\n\t//\t\t\tif(startHandlers){\n\t//\t\t\t\tfor(i = 0; i < startHandlers.length; i++){\n\t//\t\t\t\t\tstartHandlers[i](LookatEventType.STARTED, lookatInstance, {});\n\t//\t\t\t\t}\n\t//\t\t\t}\n\t//\t\t\tif(targetReachedHandlers){\n\t//\t\t\t\tfor(i = 0; i < targetReachedHandlers.length; i++){\n\t//\t\t\t\t\ttargetReachedHandlers[i](LookatEventType.TARGET_REACHED, lookatInstance, {});\n\t//\t\t\t\t}\n\t//\t\t\t}\n\t//\t\t\tif(stopHandlers){\n\t//\t\t\t\tfor(i = 0; i < stopHandlers.length; i++){\n\t//\t\t\t\t\tstopHandlers[i](LookatEventType.STOPPED, lookatInstance, {});\n\t//\t\t\t\t}\n\t//\t\t\t}\n\t//\t\t};\n\t//\t}\n\t//};\n\n\t//map between timeline events and lookat events\n\tvar createStartedHandler = function(lookatInstance){\n\t\tvar h = eventHandlers[LookatEventType.STARTED];\n\t\tif(h) {\n\t\t\tvar startHandlers = h.slice(0);\n\t\t\treturn function () {\n\t\t\t\tfor (var i = 0; i < startHandlers.length; i++) {\n\t\t\t\t\tstartHandlers[i](LookatEventType.STARTED, lookatInstance, {});\n\t\t\t\t}\n\t\t\t};\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tvar createTargetReachedHandler = function(lookatInstance){\n\t\tvar h = eventHandlers[LookatEventType.TARGET_REACHED];\n\t\tif(h) {\n\t\t\tvar reachedHandlers = h.slice(0);\n\t\t\treturn function (target) {\n\t\t\t\tfor (var i = 0; i < reachedHandlers.length; i++) {\n\t\t\t\t\treachedHandlers[i](LookatEventType.TARGET_REACHED, lookatInstance, {target:target});\n\t\t\t\t}\n\t\t\t};\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tvar createTargetSupersededHandler = function(lookatInstance){\n\t\tvar h = eventHandlers[LookatEventType.TARGET_SUPERSEDED];\n\t\tif(h) {\n\t\t\tvar supersededHandlers = h.slice(0);\n\t\t\treturn function (target) {\n\t\t\t\tfor (var i = 0; i < supersededHandlers.length; i++) {\n\t\t\t\t\tsupersededHandlers[i](LookatEventType.TARGET_SUPERSEDED, lookatInstance, {target:target});\n\t\t\t\t}\n\t\t\t};\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t//map between timeline events and lookat events\n\tvar createStoppedHandler = function(lookatInstance){\n\t\tvar hStopped = eventHandlers[LookatEventType.STOPPED];\n\t\tif(hStopped) {\n\t\t\tvar stopHandlers = null;\n\t\t\tif(hStopped) {\n\t\t\t\tstopHandlers = hStopped.slice(0);\n\t\t\t}\n\t\t\treturn function (interrupted) { //for single shot lookat, we're interrupted if we didn't complete, just as an animation\n\t\t\t\tif(stopHandlers){\n\t\t\t\t\tfor (var i = 0; i < stopHandlers.length; i++) {\n\t\t\t\t\t\tstopHandlers[i](LookatEventType.STOPPED, lookatInstance, {interrupted: interrupted});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t//map between timeline events and lookat events\n\tvar createRemovedHandler = function(lookatInstance){\n\t\tvar hStopped = eventHandlers[LookatEventType.STOPPED];\n\t\tvar hCancelled = eventHandlers[LookatEventType.CANCELLED];\n\t\tif(hStopped || hCancelled) {\n\t\t\tvar stopHandlers = null;\n\t\t\tvar cancelHandlers = null;\n\t\t\tif(hStopped){\n\t\t\t\tstopHandlers = hStopped.slice(0);\n\t\t\t}\n\t\t\tif(hCancelled){\n\t\t\t\tcancelHandlers = hCancelled.slice(0);\n\t\t\t}\n\t\t\treturn function (started, stopped) {\n\t\t\t\tvar i;\n\t\t\t\tif(stopHandlers) {\n\t\t\t\t\tif (started && !stopped) { //if a clip is removed after start and before stop, we'll send a stop (interrupted) to the listeners\n\t\t\t\t\t\tfor ( i = 0; i < stopHandlers.length; i++) {\n\t\t\t\t\t\t\tstopHandlers[i](LookatEventType.STOPPED, lookatInstance, {interrupted: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(cancelHandlers) {\n\t\t\t\t\tif (!started) { //if it never started, then we'll send a cancel.\n\t\t\t\t\t\tfor ( i = 0; i < stopHandlers.length; i++) {\n\t\t\t\t\t\t\tcancelHandlers[i](LookatEventType.CANCELLED, lookatInstance, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}else{\n\t\t\treturn null;\n\t\t}\n\t};\n\n\n};\n\n\n\n\n\n\n\nmodule.exports = SingleLookatBuilder;\n"],"sourceRoot":"/source/"}