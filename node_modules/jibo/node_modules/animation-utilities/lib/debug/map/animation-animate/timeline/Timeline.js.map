{"version":3,"sources":["animation-animate/timeline/Timeline.js"],"names":[],"mappings":"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","file":"animation-animate/timeline/Timeline.js","sourcesContent":["/**\n * @author mattb\n */\n\n\"use strict\";\n\nvar TimelineEventDispatcher = require(\"./TimelineEventDispatcher\");\n\n/**\n * Called when a clip's end is passed over by the current time.\n *\n * @callback ClipStartedHandler\n */\n\n/**\n * Called when a clip's end is passed over by the current time.\n *\n * @callback ClipStoppedHandler\n * @param {boolean} interrupted - true if clip ended prematurely (its actual duration is less than than its underlying Motion)\n */\n\n/**\n * Called when a clip is removed from the timeline.\n *\n * @callback ClipRemovedHandler\n * @param {boolean} didStart - true if the clip did start through timeline advancing\n * @param {boolean} didStop - true if the clip did stop through timeline advancing\n */\n\n/**\n * Called when a custom clip event is passed over by the current time.\n *\n * @callback ClipEventHandler\n * @param {*} payload - custom event payload\n */\n\n/**\n * @param {Clock} clock\n * @constructor\n */\nvar Timeline = function(clock)\n{\n\t/** @type {Clock} */\n\tthis.clock = clock;\n\t/** @type {Object.<string, TimelineDelegate>} */\n\tthis.delegates = {};\n\t/** @type {Time} */\n\tthis.lastCullTime = null;\n};\n\n/**\n *\n * @param {string} modality\n * @param {TimelineDelegate} delegate\n */\nTimeline.prototype.installModalityDelegate = function(modality, delegate)\n{\n\tthis.delegates[modality] = delegate;\n};\n\n/**\n * @return {string[]}\n */\nTimeline.prototype.getModalities = function()\n{\n\treturn Object.keys(this.delegates);\n};\n\n/**\n * @param {string}modality\n *\n * @return {TimelineDelegate}\n */\nTimeline.prototype.getModalityDelegate = function(modality)\n{\n\treturn this.delegates[modality];\n};\n\n/**\n * @return {Clock}\n */\nTimeline.prototype.getClock = function()\n{\n\treturn this.clock;\n};\n\n/**\n *\n * @param {string} modality\n * @param {string} name\n * @param {Time} startTime\n * @param {*} payload\n * @param {string} layer\n * @param {ClipStartedHandler} clipStartedHandler\n * @param {ClipStoppedHandler} clipStoppedHandler\n * @param {ClipRemovedHandler} clipRemovedHandler\n * @param {ClipEventHandler} clipEventHandler\n *\n * @return {TimelineClip}\n */\nTimeline.prototype.add = function(modality, name, startTime, payload, layer, clipStartedHandler, clipStoppedHandler, clipRemovedHandler, clipEventHandler)\n{\n\treturn this.delegates[modality].add(name, startTime, payload, layer, clipStartedHandler, clipStoppedHandler, clipRemovedHandler, clipEventHandler);\n};\n\n/**\n *\n * @param {string} modality\n * @param {Time} startTime\n * @param {Time} endTime\n *\n * @return {TimelineClip[]}\n */\nTimeline.prototype.getClipsInInterval = function(modality, startTime, endTime)\n{\n\treturn this.delegates[modality].getClipsInInterval(startTime, endTime);\n};\n\n/**\n *\n * @param {string} modality\n * @param {Time} time\n *\n * @return {*}\n */\nTimeline.prototype.getStateAtTime = function(modality, time)\n{\n\treturn this.delegates[modality].getStateAtTime(time);\n};\n\n/**\n *\n * @param {string} modality\n * @param {*} payload\n *\n * @return {number}\n */\nTimeline.prototype.getReactionTime = function(modality, payload)\n{\n\treturn this.delegates[modality].getReactionTime(payload);\n};\n\n/**\n * Must be called frequently.  Dispatches events and\n * culls old data.\n */\nTimeline.prototype.update = function()\n{\n\tvar modalities = this.getModalities();\n\tvar i;\n\tfor (i=0; i<modalities.length; i++)\n\t{\n\t\tthis.delegates[modalities[i]].update();\n\t}\n\n\tvar currentTime = this.clock.currentTime();\n\n\tif (!this.lastCullTime)\n\t{\n\t\tthis.lastCullTime = currentTime;\n\t}\n\n\tif (currentTime.subtract(this.lastCullTime) > 5)\n\t{\n\t\tfor (i=0; i<modalities.length; i++)\n\t\t{\n\t\t\tthis.delegates[modalities[i]].cullUpToTime(currentTime.add(-2));\n\t\t}\n\t\tthis.lastCullTime = currentTime;\n\t}\n\n\tTimelineEventDispatcher.dispatchQueuedEvents();\n};\n\nmodule.exports = Timeline;"],"sourceRoot":"/source/"}