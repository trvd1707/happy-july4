{"version":3,"sources":["animation-animate/timeline/BaseMotionGenerator.js"],"names":[],"mappings":"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","file":"animation-animate/timeline/BaseMotionGenerator.js","sourcesContent":["/**\n * @author jg\n */\n\n\"use strict\";\n\nvar MotionGenerator = require(\"./MotionGenerator\");\nvar TimelineEventDispatcher = require(\"./TimelineEventDispatcher\");\n\n/**\n *\n * @param name\n * @param startTime\n * @param dofNames\n * @param targetDuration\n * @constructor\n * @extends MotionGenerator\n */\nvar BaseMotionGenerator = function(name, startTime, dofNames, targetDuration)\n{\n\tMotionGenerator.call(this);\n\n\t/** @type {Time} */\n\tthis._startTime = startTime;\n\n\t/** @type {string} */\n\tthis._name = name;\n\t/** @type {MotionEvent[]} */\n\tthis._customEvents = [];\n\n\t/** @type {number} */\n\tthis._targetDuration = targetDuration;\n\n\tthis._entered = false;\n\tthis._exited = false;\n\n\t/** @type {ClipStartedHandler} */\n\tthis._clipStartedHandler = null;\n\t/** @type {ClipStoppedHandler} */\n\tthis._clipStoppedHandler = null;\n\t/** @type {ClipRemovedHandler} */\n\tthis._clipRemovedHandler = null;\n\t/** @type {ClipEventHandler} */\n\tthis._clipEventHandler = null;\n\n\t//setup mask, currently all joints active for entire time\n\t/** @type {Object<string, number>} */\n\tthis._mask = {};\n\n\tfor(var i = 0; i < dofNames.length; i++){\n\t\tthis._mask[dofNames[i]] = targetDuration;\n\t}\n\n\t/** @type {Time} */\n\tthis._currentTime = null;\n};\n\nBaseMotionGenerator.prototype = Object.create(MotionGenerator.prototype);\nBaseMotionGenerator.prototype.constructor = BaseMotionGenerator;\n\n\n/**\n * @param {ClipStartedHandler} clipStartedHandler\n * @param {ClipStoppedHandler} clipStoppedHandler\n * @param {ClipRemovedHandler} clipRemovedHandler\n * @param {ClipEventHandler} clipEventHandler\n */\nBaseMotionGenerator.prototype.setHandlers = function(clipStartedHandler, clipStoppedHandler, clipRemovedHandler, clipEventHandler)\n{\n\tthis._clipStartedHandler = clipStartedHandler;\n\tthis._clipStoppedHandler = clipStoppedHandler;\n\tthis._clipRemovedHandler = clipRemovedHandler;\n\tthis._clipEventHandler = clipEventHandler;\n};\n\n/**\n * @param {MotionEvent[]} motionEvents\n */\nBaseMotionGenerator.prototype.setEvents = function(motionEvents)\n{\n\tfor (var evi = 0; evi < motionEvents.length; evi++)\n\t{\n\t\tthis._customEvents.push(motionEvents[evi]);\n\t}\n};\n\n/**\n * @returns {string}\n * @override\n */\nBaseMotionGenerator.prototype.getName = function()\n{\n\treturn this._name;\n};\n\n/**\n * @returns {Time}\n * @override\n */\nBaseMotionGenerator.prototype.getStartTime = function()\n{\n\treturn this._startTime;\n};\n\n/**\n * @returns {Time}\n * @override\n */\nBaseMotionGenerator.prototype.getEndTime = function()\n{\n\treturn this._startTime.add(this.getDuration());\n};\n\n/**\n * @returns {number}\n * @override\n */\nBaseMotionGenerator.prototype.getDuration = function()\n{\n\tvar longestDuration = 0;\n\tvar maskKeys = Object.keys(this._mask);\n\tfor(var mki = 0; mki < maskKeys.length; mki++){\n\t\tvar maskKey = maskKeys[mki];\n\t\tif(this._mask[maskKey] > longestDuration){\n\t\t\tlongestDuration = this._mask[maskKey];\n\t\t}\n\t}\n\treturn longestDuration;\n};\n\n/**\n * @param {string} dofName\n * @returns {Time} returns end time for DOF or null if DOF fully not included\n * @override\n */\nBaseMotionGenerator.prototype.getEndTimeForDOF = function(dofName)\n{\n\tif(this._mask.hasOwnProperty(dofName)) {\n\t\treturn this.getStartTime().add(this._mask[dofName]);\n\t}else{\n\t\treturn null;\n\t}\n};\n\n/**\n * @param {string} dofName\n * @returns {number} returns duration for DOF or null if DOF fully not included\n * @override\n */\nBaseMotionGenerator.prototype.getDurationForDOF = function(dofName)\n{\n\tif(this._mask.hasOwnProperty(dofName)) {\n\t\treturn this._mask[dofName];\n\t}else{\n\t\treturn null;\n\t}\n};\n\n/**\n * Force this motion to end all its tracks at or before cropTime.  If a track\n * already ends before cropTime it is unchanged.  If a a track starts after\n * cropTime it is completely removed.\n *\n * @param {Time} cropTime - crop to end at this time if necessary\n * @param {string[]} [cropMask] - only crop dofs present in this mask (all dofs if omitted)\n * @override\n */\nBaseMotionGenerator.prototype.cropEnd = function(cropTime, cropMask)\n{\n\tvar cropMaskKeys;\n\tif(cropMask!=null){ //null or undefined (eqnull)\n\t\tcropMaskKeys = cropMask;\n\t}else{\n\t\tcropMaskKeys = Object.keys(this._mask);\n\t}\n\tvar croppedDuration = cropTime.subtract(this._startTime);\n\tvar cmi;\n\tif(croppedDuration > 0) {\n\t\tfor (cmi = 0; cmi < cropMaskKeys.length; cmi++) {\n\t\t\tvar cropThisDOF = cropMaskKeys[cmi];\n\t\t\tif (this._mask.hasOwnProperty(cropThisDOF)) {\n\t\t\t\tif (this._mask[cropThisDOF] > croppedDuration) {\n\t\t\t\t\tthis._mask[cropThisDOF] = croppedDuration;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}else{\n\t\tfor (cmi = 0; cmi < cropMaskKeys.length; cmi++) {\n\t\t\tdelete this._mask[cropMaskKeys[cmi]];\n\t\t}\n\t}\n};\n\n/**\n * get all DOFs that are involved in this motion (except for any that\n * have been removed completely via cropping)\n *\n * @returns {string[]}\n * @override\n */\nBaseMotionGenerator.prototype.getDOFs = function()\n{\n\treturn Object.keys(this._mask);\n};\n\n/**\n * Get all dofs that are currently active at the given time\n * @param {Time} time\n * @returns {string[]}\n */\nBaseMotionGenerator.prototype.getActiveDOFs = function(time)\n{\n\tvar activeDOFs = [];\n\tif(time.isGreaterOrEqual(this._startTime))\n\t{\n\t\tvar possibleDOFs = Object.keys(this._mask);\n\t\tfor (var i = 0; i < possibleDOFs.length; i++)\n\t\t{\n\t\t\tif (this.getEndTimeForDOF(possibleDOFs[i]).isGreater(time))\n\t\t\t{\n\t\t\t\tactiveDOFs.push(possibleDOFs[i]);\n\t\t\t}\n\t\t}\n\t}\n\treturn activeDOFs;\n};\n\n\n/**\n * @returns {boolean}\n * @override\n */\nBaseMotionGenerator.prototype.hasEntered = function()\n{\n\treturn this._entered;\n};\n\n/**\n * @returns {boolean}\n * @override\n */\nBaseMotionGenerator.prototype.hasExited = function()\n{\n\treturn this._exited;\n};\n\n/**\n *\n * @param {Time} currentTime\n * @override\n */\nBaseMotionGenerator.prototype.notifyUpdateStarted = function(currentTime)\n{\n\tthis._currentTime = currentTime;\n};\n\n/**\n *\n * @override\n */\nBaseMotionGenerator.prototype.notifyUpdateFinished = function()\n{\n\tif(!this._entered && this._currentTime.isGreaterOrEqual(this.getStartTime()))\n\t{\n\t\tthis._entered = true;\n\t\t//console.log(\"Event: Clip \"+clip.getName()+\" Started!!\");\n\t\tif(this._clipStartedHandler)\n\t\t{\n\t\t\tTimelineEventDispatcher.queueEvent(this._clipStartedHandler, []);\n\t\t}\n\t}\n\tif(this._entered && !this._exited)\n\t{\n\t\tthis.queueCustomEvents();\n\t}\n\tif(this._entered && !this._exited && this._currentTime.isGreaterOrEqual(this.getEndTime()))\n\t{\n\t\tthis._exited = true;\n\t\tvar interrupted = Math.abs(this.getDuration() - this._targetDuration) > 0.001;\n\t\t//console.log(\"Event: Clip \"+clip.getName()+\" Stopped!! (interrupted=\"+interrupted+\")\");\n\t\tif(this._clipStoppedHandler)\n\t\t{\n\t\t\tTimelineEventDispatcher.queueEvent(this._clipStoppedHandler, [interrupted]);\n\t\t}\n\t}\n};\n\n/**\n *\n * @override\n */\nBaseMotionGenerator.prototype.notifyRemoved = function()\n{\n\tif (this._clipRemovedHandler)\n\t{\n\t\tTimelineEventDispatcher.queueEvent(this._clipRemovedHandler, [this._entered, this._exited]);\n\t}\n};\n\n\nBaseMotionGenerator.prototype.queueCustomEvents = function()\n{\n\tif(this.hasEntered() && !this.hasExited() && this._clipEventHandler)\n\t{\n\t\tvar relativeCurrentTime = this._currentTime.subtract(this.getStartTime());\n\t\tvar relativeEndTime = this.getDuration();\n\n\t\twhile(this._customEvents.length > 0 &&\n\t\tthis._customEvents[0].getTimestamp() <= relativeCurrentTime &&\n\t\tthis._customEvents[0].getTimestamp() <= relativeEndTime){\n\t\t\tTimelineEventDispatcher.queueEvent(this._clipEventHandler, [this._customEvents[0]]);\n\t\t\tthis._customEvents.shift();\n\t\t}\n\t}\n};\n\n\nmodule.exports = BaseMotionGenerator;"],"sourceRoot":"/source/"}