{"version":3,"sources":["animation-visualize/JiboEye.js"],"names":[],"mappings":"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","file":"animation-visualize/JiboEye.js","sourcesContent":["/**\n * @author mattb\n */\n\n\"use strict\";\n\nvar ArticulatedModelLoader = require(\"../ifr-geometry/loaders/ArticulatedModelLoader\");\nvar KinematicsLoader = require(\"../ifr-motion/loaders/KinematicsLoader\");\nvar TextureControl = require(\"../ifr-motion/dofs/TextureControl\");\nvar THREE = require(\"three\");\n\n/**\n * @param {JiboConfig} jiboConfig\n * @private\n * @constructor\n */\nvar JiboEye = function(jiboConfig)\n{\n\t/** @type {JiboConfig} */\n\tthis._config = jiboConfig;\n\n\t/** @type {CachedImageLoader} */\n\tthis._textureLoader = null;\n\n\t/** @type {THREE.Object3D} */\n\tthis._modelRoot = null;\n\t/** @type {ModelControlGroup} */\n\tthis._modelControlGroup = null;\n\n\t/** @type {!boolean} */\n\tthis.loadSucceeded = false;\n\t/** @type {string} */\n\tthis.loadMessage = \"\";\n};\n\n/**\n * @param {CachedImageLoader} textureLoader\n */\nJiboEye.prototype.setTextureLoader = function(textureLoader)\n{\n\tthis._textureLoader = textureLoader;\n};\n\nJiboEye.prototype.load = function(callback)\n{\n\tvar self = this;\n\n\tvar loader = new ArticulatedModelLoader();\n\tloader.load(\"eye model\", self._config.getEyeGeometryURL(), self._config.getEyeSkeletonURL(), function()\n\t{\n\t\tvar result = loader.getResult();\n\t\tif (result.success)\n\t\t{\n\t\t\tself._modelRoot = result.modelRoot;\n\n\t\t\t// prepare eye overlays\n\t\t\tvar overlayZ = 0;\n\t\t\tvar deltaZ = 0.01;\n\t\t\tfor (var childIndex=0; childIndex<self._modelRoot.children.length; childIndex++)\n\t\t\t{\n\t\t\t\tvar child = self._modelRoot.children[childIndex];\n\t\t\t\tif (child instanceof THREE.SkinnedMesh)\n\t\t\t\t{\n\t\t\t\t\tchild.material.transparent = true;\n\t\t\t\t\tchild.frustumCulled = false;\n\t\t\t\t\tchild.position.z = overlayZ;\n\t\t\t\t\toverlayZ += deltaZ;\n\t\t\t\t}\n\t\t\t}\n\t\t\tself._modelRoot.traverse(function(obj){\n\t\t\t\tif(obj instanceof THREE.Mesh)\n\t\t\t\t{ //screen background should also be transparent\n\t\t\t\t\tobj.material.transparent = true;\n\t\t\t\t\tobj.frustumCulled = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar kinematicsLoader = new KinematicsLoader();\n\t\t\t/** @type {TextureControl.Factory} */\n\t\t\tvar textureFactory = kinematicsLoader.getModelControlFactory(TextureControl.Factory.prototype._controlType);\n\t\t\tif (self._textureLoader)\n\t\t\t{\n\t\t\t\ttextureFactory.setSharedImageLoader(self._textureLoader);\n\t\t\t}\n\n\t\t\tkinematicsLoader.load(self._config.getEyeKinematicsURL(), function()\n\t\t\t{\n\t\t\t\tvar kinematicsResult = kinematicsLoader.getResult();\n\t\t\t\tif (kinematicsResult.success)\n\t\t\t\t{\n\t\t\t\t\tself._modelControlGroup = kinematicsResult.modelControlGroup;\n\t\t\t\t\tself._modelControlGroup.attachToModel(self._modelRoot);\n\n\t\t\t\t\t//config for default normal map for users not specifying a normal url\n\t\t\t\t\tfor(var ci = 0; ci < self._modelControlGroup.getControlList().length; ci++){\n\t\t\t\t\t\tif(self._modelControlGroup.getControlList()[ci].getControlType() === \"TEXTURE\"){\n\t\t\t\t\t\t\tself._modelControlGroup.getControlList()[ci].setDefaultNormalURL(self._config.getDefaultNormalMap());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tself.loadSucceeded = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tself.loadSucceeded = false;\n\t\t\t\t\tself.loadMessage = \"kinematics load failed with message: \"+kinematicsResult.message+\", URL = \"+kinematicsResult.url;\n\t\t\t\t}\n\t\t\t\tif (callback)\n\t\t\t\t{\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tself.loadSucceeded = false;\n\t\t\tself.loadMessage = \"\"+result.message+\", model URL = \"+result.modelUrl+\", skeleton URL = \"+result.skeletonUrl;\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t});\n};\n\n/**\n * @return {THREE.Object3D}\n */\nJiboEye.prototype.getModelRoot = function()\n{\n\treturn this._modelRoot;\n};\n\n/**\n * @return {ModelControlGroup}\n */\nJiboEye.prototype.getModelControlGroup = function()\n{\n\treturn this._modelControlGroup;\n};\n\n/**\n * @param {SceneInfo} sceneInfo\n * @return {THREE.Camera}\n */\nJiboEye.prototype.constructCamera = function(sceneInfo)\n{\n\tvar camera = new THREE.OrthographicCamera(-sceneInfo.faceScreenWidth/2, sceneInfo.faceScreenWidth/2, sceneInfo.faceScreenHeight/2, -sceneInfo.faceScreenHeight/2, -20, 20);\n\tcamera.position.set(0,0,5); //need to provide a position for lighting to work\n\n\t//could do as perspective, if having trouble with lighting:\n\t//var distance = 5;\n\t//var fov = 0.79;\n\t//var camera = new THREE.PerspectiveCamera(fov, sceneInfo.faceScreenWidth/sceneInfo.faceScreenHeight, distance-0.5, distance+0.5);\n\t//camera.position.set(0,0,distance);\n\t//camera.lookAt(new THREE.Vector3(0,0,0));\n\t//console.log(\"Camera matrixWorld = \"+camera.matrixWorld.elements);\n\n\tcamera.updateMatrixWorld(true);\n\treturn camera;\n};\n\n/**\n * @return {THREE.Scene}\n */\nJiboEye.prototype.constructScene = function()\n{\n\tvar scene = new THREE.Scene();\n\tscene.add(this.getModelRoot());\n\treturn scene;\n};\n\nmodule.exports = JiboEye;"],"sourceRoot":"/source/"}