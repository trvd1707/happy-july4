{"version":3,"sources":["ifr-core/FileTools.js"],"names":[],"mappings":"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","file":"ifr-core/FileTools.js","sourcesContent":["/**\n * @author mattb\n * Copyright 2015 IF Robots LLC\n */\n\n\"use strict\";\n\nvar URI = require(\"urijs\");\n\n\nvar FileTools = {};\n\n\n/**\n * @callback FileLoadCallback\n * @param {string} error - error message, null if file load succeeded\n * @param {*} data - loaded file contents\n */\n\n\n/**\n * Load text data from a URL.\n * @param {string} url\n * @param {FileLoadCallback} callback\n */\nFileTools.loadText = function(url, callback)\n{\n\tvar uri = new URI(url);\n\t// bypass the cache\n\turi.addQuery(\"\"+(new Date().getTime()));\n\n\tif (typeof(XMLHttpRequest) !== \"undefined\")\n\t{\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open(\"GET\", uri.toString(), true);\n\t\txhr.addEventListener(\"load\", function(event) // eslint-disable-line no-unused-vars\n\t\t{\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tif (xhr.status === 200 || xhr.status === 0)\n\t\t\t\t{\n\t\t\t\t\tcallback(null, xhr.responseText);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallback(\"FileTools: XMLHttpRequest failed with status: \"+xhr.statusText, null);\n\t\t\t\t}\n\t\t\t}\n\t\t}, false);\n\t\txhr.addEventListener(\"error\", function(event) // eslint-disable-line no-unused-vars\n\t\t{\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tcallback(\"FileTools: XMLHttpRequest error event with status: \"+xhr.statusText, null);\n\t\t\t}\n\t\t}, false);\n\t\txhr.send(null);\n\t}\n\telse if (uri.protocol() === \"http\")\n\t{\n\t\tvar http = \"http\";\n\t\thttp = require(http);\n\n\t\tvar options = {\n\t\t\thost: uri.hostname(),\n\t\t\tport: (uri.port() ? parseInt(uri.port()) : 80),\n\t\t\tpath: uri.resource(),\n\t\t\tmethod: \"GET\"\n\t\t};\n\n\t\tvar request = http.request(options, function(result)\n\t\t{\n\t\t\tif (result.statusCode === 200)\n\t\t\t{\n\t\t\t\tresult.setEncoding(\"utf8\");\n\t\t\t\tresult.on(\"data\", function(chunk)\n\t\t\t\t{\n\t\t\t\t\tif (callback)\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback(null, chunk);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (callback)\n\t\t\t\t{\n\t\t\t\t\tcallback(\"FileTools: http request failed with status code: \"+result.statusCode, null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\trequest.on(\"error\", function(e)\n\t\t{\n\t\t\tif (callback)\n\t\t\t{\n\t\t\t\tcallback(e.message, null);\n\t\t\t}\n\t\t});\n\n\t\trequest.end();\n\t}\n\telse if (uri.protocol() === \"file\" || uri.protocol() === \"\")\n\t{\n\t\tvar fs = \"fs\";\n\t\tfs = require(fs);\n\t\tfs.readFile(uri.path(), \"utf8\", callback);\n\t}\n\telse\n\t{\n\t\t// unsupported protocol\n\t\tif (callback)\n\t\t{\n\t\t\tcallback(\"FileTools: no XMLHttpRequest available, and no fallback support for protocol: \"+uri.protocol(), null);\n\t\t}\n\t}\n};\n\n/**\n * Load JSON data from a URL.\n * @param {string} url\n * @param {FileLoadCallback} callback\n */\nFileTools.loadJSON = function(url, callback)\n{\n\tFileTools.loadText(url, function(error, data)\n\t{\n\t\tif (callback)\n\t\t{\n\t\t\tif (error)\n\t\t\t{\n\t\t\t\tcallback(error, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar jsonData = null;\n\t\t\t\tvar parseError = false;\n\t\t\t\tvar parseErrorMessage = \"\";\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tjsonData = JSON.parse(data);\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\tparseError = true;\n\t\t\t\t\tparseErrorMessage = e;\n\t\t\t\t}\n\n\t\t\t\tif (!parseError)\n\t\t\t\t{\n\t\t\t\t\tcallback(null, jsonData);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcallback(\"FileTools: JSON parse error: \"+parseErrorMessage, null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\n\nmodule.exports = FileTools;\n"],"sourceRoot":"/source/"}