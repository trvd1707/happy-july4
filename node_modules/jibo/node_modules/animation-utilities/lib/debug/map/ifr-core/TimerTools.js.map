{"version":3,"sources":["ifr-core/TimerTools.js"],"names":[],"mappings":"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","file":"ifr-core/TimerTools.js","sourcesContent":["/**\n * @author mattb\n * Copyright 2015 IF Robots LLC\n */\n\n\"use strict\";\n\n/**\n * @typedef {Object} Timer\n * @property {function} stop - stops the timer\n */\n\n/**\n * @param {function} callback - the callback\n * @param {number} intervalTimeMillis - interval in milliseconds at which to call the callback\n * @constructor\n */\nvar BrowserTimer = function(callback, intervalTimeMillis)\n{\n\tvar intervalHandle = setInterval(callback, intervalTimeMillis);\n\tthis.stop = function()\n\t{\n\t\tclearInterval(intervalHandle);\n\t};\n};\n\nvar workerScript = \"\" +\n\"\"+\"var timerHandles = {};\"+\"\\n\"+\n\"\"+\"self.onmessage = function(event)\"+\"\\n\"+\n\"\"+\"{\"+\"\\n\"+\n\"\"+\"\tvar command = event.data.command;\"+\"\\n\"+\n\"\"+\"\tvar callbackID = event.data.callbackID;\"+\"\\n\"+\n\"\"+\"\tvar callbackInterval = event.data.callbackInterval;\"+\"\\n\"+\n\"\"+\"\tvar timerHandle = null;\"+\"\\n\"+\n\"\"+\"\"+\"\\n\"+\n\"\"+\"\tif (command === 'start')\"+\"\\n\"+\n\"\"+\"\t{\"+\"\\n\"+\n\"\"+\"\t\ttimerHandle = setInterval(function()\"+\"\\n\"+\n\"\"+\"\t\t{\"+\"\\n\"+\n\"\"+\"\t\t\tself.postMessage({callbackID: callbackID});\"+\"\\n\"+\n\"\"+\"\t\t}, callbackInterval);\"+\"\\n\"+\n\"\"+\"\t\ttimerHandles[callbackID] = timerHandle;\"+\"\\n\"+\n\"\"+\"\t}\"+\"\\n\"+\n\"\"+\"\telse if (command === 'stop')\"+\"\\n\"+\n\"\"+\"\t{\"+\"\\n\"+\n\"\"+\"\t\ttimerHandle = timerHandles[callbackID];\"+\"\\n\"+\n\"\"+\"\t\tif (timerHandle !== undefined && timerHandle !== null)\"+\"\\n\"+\n\"\"+\"\t\t{\"+\"\\n\"+\n\"\"+\"\t\t\tclearInterval(timerHandle);\"+\"\\n\"+\n\"\"+\"\t\t}\"+\"\\n\"+\n\"\"+\"\t}\"+\"\\n\"+\n\"\"+\"};\"+\"\\n\"+\n\"\";\n\n/**\n * @constructor\n */\nvar WebWorkerTimerFactory = function()\n{\n\tvar workerBlob = new Blob([workerScript], {type: \"text/javascript\"});\n\tvar workerURL = URL.createObjectURL(workerBlob);\n\tvar worker = new Worker(workerURL);\n\n\t/** @type {Object.<number, function>} */\n\tvar callbackMap = {};\n\tvar nextCallbackID = 0;\n\n\t/**\n\t * @param {function} callback - the callback\n\t * @param {number} intervalTimeMillis - interval in milliseconds at which to call the callback\n\t * @return {Timer}\n\t */\n\tthis.createTimer = function(callback, intervalTimeMillis)\n\t{\n\t\tvar callbackID = nextCallbackID;\n\t\tcallbackMap[callbackID] = callback;\n\t\tnextCallbackID++;\n\n\t\tworker.postMessage({command: \"start\", callbackID: callbackID, callbackInterval: intervalTimeMillis});\n\n\t\tvar timer = {};\n\t\ttimer.stop = function()\n\t\t{\n\t\t\tcallbackMap[callbackID] = null;\n\t\t\tworker.postMessage({command: \"stop\", callbackID: callbackID});\n\t\t};\n\t\treturn timer;\n\t};\n\n\tworker.onmessage = function(event)\n\t{\n\t\tvar callbackID = event.data.callbackID;\n\t\tvar callback = callbackMap[callbackID];\n\t\tif (callback)\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t};\n};\n\n/** @type {WebWorkerTimerFactory} */\nvar timerFactory = null;\n/** @type boolean */\nvar workersAreAllowed = true;\n\nvar TimerTools = {};\n\n/**\n * Creates a timer to repeatedly call the specified callback with the given time interval.\n * Call stop() on the returned object to cancel/stop the timer.\n * @param {function} callback - the callback\n * @param {number} intervalTimeMillis - interval in milliseconds at which to call the callback\n * @return {Timer}\n */\nTimerTools.setInterval = function(callback, intervalTimeMillis)\n{\n\tif (intervalTimeMillis < 1000 && typeof(Worker) !== \"undefined\" && workersAreAllowed)\n\t{\n\t\tif (timerFactory === null)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\ttimerFactory = new WebWorkerTimerFactory();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\t// workers aren't allowed, fail back to setInterval\n\t\t\t\tconsole.log(\"TimerTools: Worker blobs don't seem to be allowed, falling back to standard setInterval timing.\");\n\t\t\t\tworkersAreAllowed = false;\n\t\t\t\treturn new BrowserTimer(callback, intervalTimeMillis);\n\t\t\t}\n\t\t}\n\t\treturn timerFactory.createTimer(callback, intervalTimeMillis);\n\t}\n\telse\n\t{\n\t\treturn new BrowserTimer(callback, intervalTimeMillis);\n\t}\n};\n\n/**\n * Stops the specified timer object.\n * @param {Timer} timer - the timer to stop\n */\nTimerTools.clearInterval = function(timer)\n{\n\tif (timer)\n\t{\n\t\ttimer.stop();\n\t}\n};\n\nTimerTools.WebWorkerTimerFactory = WebWorkerTimerFactory;\n\nmodule.exports = TimerTools;\n"],"sourceRoot":"/source/"}