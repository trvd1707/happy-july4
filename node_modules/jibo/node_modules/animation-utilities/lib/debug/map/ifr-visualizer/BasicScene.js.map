{"version":3,"sources":["ifr-visualizer/BasicScene.js"],"names":[],"mappings":"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","file":"ifr-visualizer/BasicScene.js","sourcesContent":["/**\n * @author mattb\n * Copyright 2014 IF Robots LLC\n */\n\n\"use strict\";\n\nvar TrackballControls = require(\"./TrackballControls\");\nvar THREE = require(\"three\");\nvar Stats = require(\"stats-js\");\n\n/**\n * @param {HTMLElement} containerElement\n * @param {boolean} installControls\n * @param {boolean} installStats\n * @param {THREE.Color} clearColor\n * @constructor\n */\nvar BasicScene = function(containerElement, installControls, installStats, clearColor)\n{\n\t/** @type {HTMLElement} */\n\tthis._container = (containerElement !== undefined) ? containerElement : null;\n\n\tif (this._container)\n\t{\n\t\tvar box = this._container.getBoundingClientRect();\n\t\tthis._width = box.width;\n\t\tthis._height = box.height;\n\t}\n\telse\n\t{\n\t\tthis._width = 100;\n\t\tthis._height = 100;\n\t}\n\n\t/**\n\t * Sometimes the element appears ready, and the rendering \"happens\", but doesn't show up.\n\t * In those cases, if we're in \"renderOnlyWhenDirty\", there will be a long time with no eye rendered (until it next moves)\n\t * @type {boolean}\n\t * @private\n\t */\n\tthis._workaroundElementReadyRace = true;\n\n\t/** @type {THREE.PerspectiveCamera} */\n\tthis._camera = new THREE.PerspectiveCamera(60, this._width/this._height, 0.1, 1000);\n\tthis._camera.position.z = 20;\n\n\t/** @type {THREE.Scene} */\n\tthis._scene = new THREE.Scene();\n\n\t/** @type {THREE.AmbientLight} */\n\tthis._ambientLight = new THREE.AmbientLight(0x404040);\n\tthis._scene.add(this._ambientLight);\n\n\t/** @type {THREE.DirectionalLight} */\n\tthis._directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);\n\tthis._directionalLight.position.set(-1, 1, 1);\n\tthis._scene.add(this._directionalLight);\n\n\t/** @type {THREE.WebGLRenderer} */\n\tthis._renderer = new THREE.WebGLRenderer({antialias: true});\n\tthis._renderer.setSize(this._width, this._height);\n\tif (clearColor)\n\t{\n\t\tthis._renderer.setClearColor(clearColor);\n\t}\n\n\t/** @type {boolean} */\n\tthis._renderOnlyWhenDirty = false;\n\t/** @type {boolean} */\n\tthis._dirty = true;\n\t/** @type {number} */\n\tthis._renderEveryNFRames = 1;\n\t/** @type {number} */\n\tthis._frameSkipCounter = 0;\n\n\tvar self = this;\n\n\tif (this._container)\n\t{\n\t\tthis._container.appendChild(this._renderer.domElement);\n\t\tif(this._workaroundElementReadyRace){\n\t\t\tsetInterval(function(){self.markDirty();}, 200);\n\t\t}\n\t}\n\n\t/** @type {Array} */\n\tthis._renderCallbacks = [];\n\n\t/** @type {Array} */\n\tthis._postRenderCallbacks = [];\n\n\t/** @type TrackballControls */\n\tthis._controls = null;\n\tif (installControls)\n\t{\n\t\tthis.installTrackballControls();\n\t}\n\n\t/** @type {Stats} */\n\tthis._stats = null;\n\tif (installStats)\n\t{\n\t\tthis.installStats();\n\t}\n\n\tthis._doPlay = function(){self.play();};\n\t//this._doResize = function(){self.handleResize();};\n\t//if (this._container)\n\t//{\n\t//\twindow.addEventListener(\"resize\", this._doResize, false);\n\t//}\n};\n\nBasicScene.prototype.installTrackballControls = function()\n{\n\tif (this._controls === null)\n\t{\n\t\tthis._dirty = true;\n\n\t\tthis._controls = new TrackballControls(this._camera, this._container);\n\n\t\tthis._controls.rotateSpeed = 1.0;\n\t\tthis._controls.zoomSpeed = 1.2;\n\t\tthis._controls.panSpeed = 1.0;\n\n\t\tthis._controls.noZoom = false;\n\t\tthis._controls.noPan = false;\n\t\tthis._controls.staticMoving = true;\n\t\tthis._controls.dynamicDampingFactor = 0.3;\n\n\t\tthis._controls.keys = [ 65, 83, 68 ];\n\t}\n};\n\nBasicScene.prototype.removeTrackballControls = function()\n{\n\tif (this._controls !== null)\n\t{\n\t\tthis._dirty = true;\n\n\t\tthis._controls.dispose();\n\t\tthis._controls = null;\n\t}\n};\n\nBasicScene.prototype.installStats = function()\n{\n\tthis._dirty = true;\n\tthis._stats = new Stats();\n\tthis._stats.domElement.style.position = \"absolute\";\n\tthis._stats.domElement.style.top = \"0px\";\n\tthis._stats.domElement.style.zIndex = 100;\n\tif (this._container)\n\t{\n\t\tthis._container.appendChild(this._stats.domElement);\n\t}\n};\n\n/**\n * Set to true to only render this scene once every time markDirty has been called\n * @param {boolean} renderOnlyWhenDirty\n */\nBasicScene.prototype.setRenderOnlyWhenDirty = function(renderOnlyWhenDirty)\n{\n\tthis._renderOnlyWhenDirty = renderOnlyWhenDirty;\n};\n\n/**\n * @param {number} renderEveryNFrames - render at most once every n frames (1 means render every time)\n */\nBasicScene.prototype.setRenderEveryNFrames = function(n)\n{\n\tthis._renderEveryNFRames = n;\n};\n\n\n/**\n * Mark the scene as needing a re-render (only relevant if renderOnlyWhenDirty has been set)\n */\nBasicScene.prototype.markDirty = function()\n{\n\tthis._dirty = true;\n};\n\n\n/**\n * @return {boolean} true if did resize\n */\nBasicScene.prototype.handleResize = function() {\n\tif (!this._container)\n\t{\n\t\treturn false;\n\t}\n\n\tvar box = this._container.getBoundingClientRect();\n\tif (box.width !== this._width || box.height !== this._height)\n\t{\n\t\tthis._width = box.width;\n\t\tthis._height = box.height;\n\n\t\tthis._camera.aspect = this._width/this._height;\n\t\tthis._camera.updateProjectionMatrix();\n\n\t\tthis._renderer.setSize(this._width, this._height);\n\n\t\tif (this._controls !== null)\n\t\t{\n\t\t\tthis._controls.handleResize();\n\t\t}\n\t\treturn true;\n\t}\n\telse\n\t{\n\t\treturn false;\n\t}\n};\n\nBasicScene.prototype.detachFromContainer = function()\n{\n\tthis.stop();\n\tif (this._container)\n\t{\n\t\tthis._container.removeChild(this._renderer.domElement);\n\t\t//window.removeEventListener(\"resize\", this._doResize, false);\n\n\t\tif (this._controls)\n\t\t{\n\t\t\tthis._controls.detachFromContainer();\n\t\t}\n\t\tif (this._stats)\n\t\t{\n\t\t\tthis._container.removeChild(this._stats.domElement);\n\t\t}\n\n\t\tthis._container = null;\n\t}\n};\n\n/**\n * @param {HTMLElement} element\n */\nBasicScene.prototype.attachToContainer = function(element)\n{\n\tthis._dirty = true;\n\n\tif (this._container)\n\t{\n\t\tthis.detachFromContainer();\n\t}\n\n\tthis._container = (element !== undefined) ? element : null;\n\n\tif (this._container)\n\t{\n\t\tvar box = this._container.getBoundingClientRect();\n\t\tthis._width = box.width;\n\t\tthis._height = box.height;\n\n\t\tthis._camera.aspect = this._width/this._height;\n\t\tthis._camera.updateProjectionMatrix();\n\n\t\tthis._renderer.setSize(this._width, this._height);\n\n\t\tthis._renderer.domElement = document.adoptNode(this._renderer.domElement);\n\t\tthis._container.appendChild(this._renderer.domElement);\n\n\t\tif(this._workaroundElementReadyRace){\n\t\t\tvar self = this;\n\t\t\tsetInterval(function(){self.markDirty();}, 200);\n\t\t}\n\n\t\tif (this._controls)\n\t\t{\n\t\t\tthis._controls.attachToContainer(this._container);\n\t\t}\n\t\tif (this._stats)\n\t\t{\n\t\t\tthis._stats.domElement = document.adoptNode(this._stats.domElement);\n\t\t\tthis._container.appendChild(this._stats.domElement);\n\t\t}\n\n\t\t//window.addEventListener(\"resize\", this._doResize, false);\n\t}\n};\n\nBasicScene.prototype.dispose = function()\n{\n\tthis.detachFromContainer();\n\tthis._camera = null;\n\tthis._scene = null;\n\tthis._ambientLight = null;\n\tthis._directionalLight = null;\n\tthis._renderer = null;\n\tthis._renderCallbacks = null;\n\tthis._postRenderCallbacks = null;\n\tthis._controls = null;\n\tthis._stats = null;\n};\n\n/**\n * @return {HTMLElement}\n */\nBasicScene.prototype.getContainer = function()\n{\n\treturn this._container;\n};\n\n/**\n * @return {THREE.PerspectiveCamera}\n */\nBasicScene.prototype.getCamera = function()\n{\n\treturn this._camera;\n};\n\n/**\n * @return {THREE.Scene}\n */\nBasicScene.prototype.getScene = function()\n{\n\treturn this._scene;\n};\n\n/**\n * @return {THREE.AmbientLight}\n */\nBasicScene.prototype.getAmbientLight = function()\n{\n\treturn this._ambientLight;\n};\n\n/**\n * @return {THREE.DirectionalLight}\n */\nBasicScene.prototype.getDirectionalLight = function()\n{\n\treturn this._directionalLight;\n};\n\n/**\n * @return {THREE.WebGLRenderer}\n */\nBasicScene.prototype.getRenderer = function()\n{\n\treturn this._renderer;\n};\n\n/**\n * @return {TrackballControls}\n */\nBasicScene.prototype.getTrackballControls = function()\n{\n\treturn this._controls;\n};\n\n/**\n * @return {Stats}\n */\nBasicScene.prototype.getStats = function()\n{\n\treturn this._stats;\n};\n\nBasicScene.prototype.addRenderCallback = function(cb)\n{\n\tthis._dirty = true;\n\tthis._renderCallbacks.push(cb);\n};\n\nBasicScene.prototype.removeRenderCallback = function(cb)\n{\n\tthis._dirty = true;\n\tvar cbIndex = this._renderCallbacks.indexOf(cb);\n\tif (cbIndex > -1)\n\t{\n\t\tthis._renderCallbacks.splice(cbIndex, 1);\n\t}\n};\n\nBasicScene.prototype.addPostRenderCallback = function(cb)\n{\n\tthis._dirty = true;\n\tthis._postRenderCallbacks.push(cb);\n};\n\nBasicScene.prototype.removePostRenderCallback = function(cb)\n{\n\tthis._dirty = true;\n\tvar cbIndex = this._postRenderCallbacks.indexOf(cb);\n\tif (cbIndex > -1)\n\t{\n\t\tthis._postRenderCallbacks.splice(cbIndex, 1);\n\t}\n};\n\nBasicScene.prototype.render = function()\n{\n\t// check for resize and update if necessary\n\tvar didResize = this.handleResize();\n\n\tthis._frameSkipCounter++;\n\n\tif((this._frameSkipCounter >= this._renderEveryNFRames) &&\n\t\t(!this._renderOnlyWhenDirty || didResize || this._dirty)) {\n\t\tif (this._controls !== null) {\n\t\t\tthis._controls.update();\n\t\t}\n\n\t\tfor (var i = 0; i < this._renderCallbacks.length; i++) {\n\t\t\tthis._renderCallbacks[i]();\n\t\t}\n\n\t\tthis._renderer.render(this._scene, this._camera);\n\n\t\tfor (i = 0; i < this._postRenderCallbacks.length; i++) {\n\t\t\tthis._postRenderCallbacks[i]();\n\t\t}\n\n\t\tif (this._stats !== null) {\n\t\t\tthis._stats.update();\n\t\t}\n\t\tthis._dirty = false;\n\t\tthis._frameSkipCounter = 0;\n\t}\n};\n\nBasicScene.prototype.play = function()\n{\n\tthis._requestHandle = window.requestAnimationFrame(this._doPlay);\n\tthis.render();\n};\n\nBasicScene.prototype.stop = function()\n{\n\tif (this._requestHandle !== undefined)\n\t{\n\t\twindow.cancelAnimationFrame(this._requestHandle);\n\t}\n};\n\nmodule.exports = BasicScene;"],"sourceRoot":"/source/"}