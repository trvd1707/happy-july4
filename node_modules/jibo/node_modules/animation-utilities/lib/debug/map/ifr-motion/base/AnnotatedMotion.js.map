{"version":3,"sources":["ifr-motion/base/AnnotatedMotion.js"],"names":[],"mappings":"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","file":"ifr-motion/base/AnnotatedMotion.js","sourcesContent":["/**\n * @author mattb\n * Copyright 2015 IF Robots LLC\n */\n\n\"use strict\";\n\nvar Motion = require(\"./Motion\");\nvar MotionEvent = require(\"./MotionEvent\");\n\n/**\n * @param {Motion} motion\n * @param {MotionEvent[]} [events]\n * @constructor\n */\nvar AnnotatedMotion = function(motion, events)\n{\n\tvar rep = {};\n\trep.motion = motion;\n\tevents = events || [];\n\trep.events = events;\n\t/** @type {number} */\n\trep.speed = 1;\n\t/** @type {number} */\n\trep.inPoint = 0;\n\t/** @type {number} */\n\trep.outPoint = motion.getDuration();\n\n\t/**\n\t * @return {Motion}\n\t */\n\tthis.getMotion = function()\n\t{\n\t\treturn rep.motion;\n\t};\n\n\t/**\n\t * @return {number}\n\t */\n\tthis.getEventCount = function()\n\t{\n\t\treturn rep.events.length;\n\t};\n\n\t/**\n\t * @param {number} index\n\t * @return {MotionEvent}\n\t */\n\tthis.getEvent = function(index)\n\t{\n\t\treturn rep.events[index];\n\t};\n\n\t/**\n\t * @return {MotionEvent[]}\n\t */\n\tthis.getEvents = function()\n\t{\n\t\treturn rep.events;\n\t};\n\n\t/**\n\t * Set sub-clip bounds.  Times are in original time scale (rather than altered timescale resulting from setSpeed)\n\t * @param {number} inPoint - clip start time in seconds.  start from beginning if null/undefined\n\t * @param {number} outPoint - clip end time in seconds.  clip to end if null/undefined\n\t */\n\tthis.setClipBounds = function(inPoint, outPoint)\n\t{\n\t\tif (inPoint !== null && inPoint !== undefined)\n\t\t{\n\t\t\trep.inPoint = inPoint;\n\t\t}\n\t\telse\n\t\t{\n\t\t\trep.inPoint = 0;\n\t\t}\n\n\t\tif (outPoint !== null && outPoint !== undefined)\n\t\t{\n\t\t\trep.outPoint = outPoint;\n\t\t}\n\t\telse\n\t\t{\n\t\t\trep.outPoint = this.getSourceMotionDuration();\n\t\t}\n\t};\n\n\t/**\n\t * Gets the duration, in seconds, of the source motion (unaffected by settings such as speed, etc).\n\t * @return {number}\n\t */\n\tthis.getSourceMotionDuration = function()\n\t{\n\t\treturn motion.getDuration();\n\t};\n\n\t/**\n\t * Gets the duration, in seconds, of this annotated motion given current settings (speed, etc).\n\t * @return {number}\n\t */\n\tthis.getDuration = function()\n\t{\n\t\tvar clipDuration = rep.outPoint - rep.inPoint;\n\t\treturn clipDuration / rep.speed;\n\t};\n\n\t/**\n\t * @return {number}\n\t */\n\tthis.getSpeed = function()\n\t{\n\t\treturn rep.speed;\n\t};\n\n\t/**\n\t * Set the speed of this motion relative to the source motion.\n\t * @param {number} speed - speed modifier (2 means twice as fast as the source motion)\n\t */\n\tthis.setSpeed = function(speed)\n\t{\n\t\tif (speed <= 0)\n\t\t{\n\t\t\tthrow new Error(\"invalid speed: \"+speed);\n\t\t}\n\n\t\tif (speed !== rep.speed)\n\t\t{\n\t\t\trep.speed = speed;\n\t\t\tif (rep.speed === 1)\n\t\t\t{\n\t\t\t\trep.motion = motion;\n\t\t\t\trep.events = events;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar newMotion = new Motion(motion.getName());\n\t\t\t\tvar trackKeys = Object.keys(motion.getTracks());\n\t\t\t\tfor(var tki = 0; tki < trackKeys.length; tki++){\n\t\t\t\t\t//duplicate each dof's track\n\t\t\t\t\tvar newTrack = motion.getTracks()[(trackKeys[tki])].clone();\n\n\t\t\t\t\t//grab the timestamps array from TimestampedBuffer\n\t\t\t\t\tvar timestamps = newTrack.getMotionData().timestampList;\n\t\t\t\t\tfor(var si = 0; si < timestamps.length; si++){\n\t\t\t\t\t\t//modify each timestamp\n\t\t\t\t\t\ttimestamps[si] = timestamps[si]/speed;\n\t\t\t\t\t}\n\n\t\t\t\t\t//modify total length\n\t\t\t\t\tnewTrack.length = newTrack.length/speed;\n\n\t\t\t\t\tnewMotion.addTrack(newTrack);\n\t\t\t\t}\n\t\t\t\trep.motion = newMotion;\n\n\t\t\t\tvar newEvents = [];\n\t\t\t\tfor (var evi = 0; evi < events.length; evi++){\n\t\t\t\t\tvar newTimestamp = events[evi].getTimestamp()/speed;\n\t\t\t\t\tvar eventName = events[evi].getEventName();\n\t\t\t\t\tvar payload = events[evi].getPayload();\n\t\t\t\t\tnewEvents.push(new MotionEvent(newTimestamp, eventName, payload));\n\t\t\t\t}\n\t\t\t\trep.events = newEvents;\n\t\t\t}\n\t\t}\n\t};\n};\n\n\nmodule.exports = AnnotatedMotion;"],"sourceRoot":"/source/"}