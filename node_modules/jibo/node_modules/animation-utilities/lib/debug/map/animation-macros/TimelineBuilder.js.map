{"version":3,"sources":["animation-macros/TimelineBuilder.js"],"names":[],"mappings":";;;;AAIA;;AAEA,IAAI,UAAU,QAAQ,kCAAR,CAAV;AACJ,IAAI,iBAAiB,QAAQ,8CAAR,CAAjB;AACJ,IAAI,sBAAsB,QAAQ,mDAAR,CAAtB;AACJ,IAAI,sBAAsB,QAAQ,mDAAR,CAAtB;AACJ,IAAI,oBAAoB,QAAQ,iDAAR,CAApB;AACJ,IAAI,sBAAsB,QAAQ,mDAAR,CAAtB;AACJ,IAAI,iBAAiB,QAAQ,uCAAR,CAAjB;AACJ,IAAI,QAAQ,QAAQ,mBAAR,CAAR;AACJ,IAAI,aAAa,QAAQ,wBAAR,CAAb;;;AAIJ,IAAI,eAAe,EAAf;;AAEJ,IAAI,mBAAmB,EAAnB;;;;;;;AAOJ,IAAI,mBAAmB,SAAnB,gBAAmB,CAAS,QAAT,EAAmB,oBAAnB,EAAyC,UAAzC,EACvB;AACC,KAAI,eAAe,WAAW,WAAX,CAAuB,YAC1C;AACC,OAAK,IAAI,IAAE,CAAF,EAAK,IAAE,WAAW,MAAX,EAAmB,GAAnC,EACA;AACC,cAAW,CAAX,EAAc,MAAd,GADD;GADA;EAFyC,EAMvC,oBANgB,CAAf,CADL;AAQC,cAAa,IAAb,CAAkB,QAAlB,EARD;AASC,kBAAiB,IAAjB,CAAsB,YAAtB,EATD;CADuB;;;;;AAgBvB,IAAI,oBAAoB,SAApB,iBAAoB,CAAS,QAAT,EACxB;AACC,KAAI,gBAAgB,aAAa,OAAb,CAAqB,QAArB,CAAhB,CADL;AAEC,KAAI,gBAAgB,CAAC,CAAD,EACpB;AACC,aAAW,aAAX,CAAyB,iBAAiB,aAAjB,CAAzB,EADD;AAEC,eAAa,MAAb,CAAoB,aAApB,EAAmC,CAAnC,EAFD;AAGC,mBAAiB,MAAjB,CAAwB,aAAxB,EAAuC,CAAvC,EAHD;EADA;CAHuB;;AAWxB,IAAI,kBAAkB;;;;;;;;;AASrB,iBAAgB,wBAAS,SAAT,EAAoB,EAApB,EAAwB,oBAAxB,EAChB;AACC,yBAAuB,oBAAC,KAAyB,SAAzB,GAAsC,oBAAvC,GAA8D,EAA9D;;;AADxB,MAIK,gBAAgB,IAAI,mBAAJ,EAAhB,CAJL;AAKC,MAAI,iBAAiB,IAAI,cAAJ,CAAmB,iBAAnB,EAAsC,SAAtC,EAAiD,KAAjD,EAAwD,aAAxD,EAAuE,QAAQ,aAAR,CAAxF;;;AALL,gBAQC,CAAe,WAAf,CAA2B,SAA3B;;;AARD,gBAWC,CAAe,WAAf,CAA2B,QAA3B,EAAqC,CAAC,UAAU,SAAV,CAAoB,MAApB,EAA4B,OAA5B,GAAsC,CAAtC,CAAD,CAArC,EAXD;AAYC,gBAAc,iBAAd,CAAgC,QAAhC,EAA0C,IAAI,iBAAJ,EAA1C;;;AAZD,gBAeC,CAAe,WAAf,CAA2B,SAA3B,EAAsC,UAAU,SAAV,CAAoB,MAApB,EAA4B,IAA5B,CAAiC,UAAjC,EAA6C,IAA7C,CAAkD,cAAlD,EAAkE,OAAlE,EAAtC,EAfD;AAgBC,gBAAc,iBAAd,CAAgC,SAAhC,EAA2C,IAAI,iBAAJ,EAA3C;;;AAhBD,MAmBK,iBAAiB,UAAU,SAAV,CAAoB,MAApB,EAA4B,IAA5B,CAAiC,UAAjC,EAA6C,IAA7C,CAAkD,cAAlD,CAAjB,CAnBL;AAoBC,MAAI,iBAAiB,UAAU,SAAV,CAAoB,YAApB,EAAkC,IAAlC,CAAuC,gBAAvC,CAAjB,CApBL;AAqBC,iBAAe,WAAf,CAA2B,MAA3B,EAAmC,eAAe,IAAf,CAAoB,cAApB,EAAoC,OAApC,EAAnC,EArBD;AAsBC,MAAI,eAAe,IAAI,mBAAJ,EAAf,CAtBL;AAuBC,eAAa,WAAb,CAAyB,eAAe,OAAf,EAAzB,EAAmD,IAAI,iBAAJ,EAAnD,EAvBD;AAwBC,MAAI,gBAAgB,IAAI,mBAAJ,CAAwB,UAAU,gBAAV,GAA6B,cAA7B,GAA8C,OAA9C,EAAxB,EAAiF,IAAjF,EAAuF,eAAe,OAAf,EAAvF,CAAhB,CAxBL;AAyBC,eAAa,WAAb,CAAyB,eAAe,OAAf,EAAzB,EAAmD,aAAnD,EAzBD;AA0BC,gBAAc,iBAAd,CAAgC,MAAhC,EAAwC,YAAxC;;;AA1BD,MA6BK,YAAY,UAAU,SAAV,CAAoB,YAApB,EAAkC,OAAlC,EAAZ,CA7BL;AA8BC,iBAAe,WAAf,CAA2B,OAA3B,EAAoC,SAApC,EA9BD;AA+BC,MAAI,gBAAgB,IAAI,mBAAJ,CAAwB,UAAU,gBAAV,GAA6B,cAA7B,GAA8C,OAA9C,EAAxB,EAAiF,IAAjF,EAAuF,SAAvF,CAAhB,CA/BL;AAgCC,gBAAc,iBAAd,CAAgC,OAAhC,EAAyC,aAAzC;;;AAhCD,MAmCK,iBAAiB,IAAI,cAAJ,CAAmB,KAAnB,CAAjB,CAnCL;AAoCC,iBAAe,gBAAf,CAAgC,UAAU,gBAAV,EAAhC,EApCD;AAqCC,iBAAe,SAAf,CAAyB,cAAzB;;;AArCD,MAwCK,aAAa,CAAC,cAAD,EAAiB,cAAjB,CAAb,CAxCL;AAyCC,mBAAiB,cAAjB,EAAiC,oBAAjC,EAAuD,UAAvD,EAzCD;;AA2CC,MAAI,EAAJ,EACA;AACC,MAAG,cAAH,EADD;GADA;;AAKA,SAAO,cAAP,CAhDD;EADgB;;;;;;;AAyDhB,kBAAiB,yBAAS,QAAT,EAAmB,QAAnB,EACjB;AACC,MAAI,UAAU,SAAS,UAAT,EAAV,CADL;AAEC,OAAK,IAAI,IAAE,CAAF,EAAK,IAAE,QAAQ,MAAR,EAAgB,GAAhC,EACA;AACC,OAAI,QAAQ,CAAR,aAAsB,cAAtB,EACJ;AACC,YAAQ,CAAR,EAAW,WAAX,CAAuB,QAAvB,EADD;AAEC,UAFD;IADA;GAFD;EAHgB;;;;;;;AAkBjB,qBAAoB,4BAAS,QAAT,EAAmB,QAAnB,EACpB;AACC,MAAI,UAAU,SAAS,UAAT,EAAV,CADL;AAEC,OAAK,IAAI,IAAE,CAAF,EAAK,IAAE,QAAQ,MAAR,EAAgB,GAAhC,EACA;AACC,OAAI,QAAQ,CAAR,aAAsB,cAAtB,EACJ;AACC,YAAQ,CAAR,EAAW,cAAX,CAA0B,QAA1B,EADD;AAEC,UAFD;IADA;GAFD;EAHmB;;;;;;;;AAmBpB,kBAAiB,yBAAS,QAAT,EAAmB,cAAnB,EACjB;AACC,oBAAkB,QAAlB,EADD;;AAGC,MAAI,mBAAmB,IAAnB,EACJ;AACC,OAAI,UAAU,SAAS,UAAT,EAAV,CADL;AAEC,QAAK,IAAI,IAAE,CAAF,EAAK,IAAE,QAAQ,MAAR,EAAgB,GAAhC,EACA;AACC,QAAI,QAAQ,CAAR,EAAW,OAAX,KAAuB,SAAvB,EACJ;AACC,aAAQ,CAAR,EAAW,OAAX,GADD;KADA;IAFD;GAHD;EAJgB;;CAvGd;;AA0HJ,OAAO,OAAP,GAAiB,eAAjB","file":"animation-macros/TimelineBuilder.js","sourcesContent":["/**\n * @author mattb\n */\n\n\"use strict\";\n\nvar animate = require(\"../animation-animate/AnimateImpl\");\nvar MotionTimeline = require(\"../animation-animate/timeline/MotionTimeline\");\nvar SimpleLayerCombiner = require(\"../animation-animate/timeline/SimpleLayerCombiner\");\nvar ScaleSampleCombiner = require(\"../animation-animate/timeline/ScaleSampleCombiner\");\nvar AddSampleCombiner = require(\"../animation-animate/timeline/AddSampleCombiner\");\nvar MixedSampleCombiner = require(\"../animation-animate/timeline/MixedSampleCombiner\");\nvar RendererOutput = require(\"../animation-visualize/RendererOutput\");\nvar Clock = require(\"../ifr-core/Clock\");\nvar TimerTools = require(\"../ifr-core/TimerTools\");\n\n\n/** @type {MotionTimeline[]} */\nvar timelineList = [];\n/** @type {Array} */\nvar updateHandleList = [];\n\n/**\n * @param {MotionTimeline} timeline\n * @param {number} updateIntervalMillis\n * @param {Object[]} updateList\n */\nvar createUpdateLoop = function(timeline, updateIntervalMillis, updateList)\n{\n\tvar updateHandle = TimerTools.setInterval(function()\n\t{\n\t\tfor (var i=0; i<updateList.length; i++)\n\t\t{\n\t\t\tupdateList[i].update();\n\t\t}\n\t}, updateIntervalMillis);\n\ttimelineList.push(timeline);\n\tupdateHandleList.push(updateHandle);\n};\n\n/**\n * @param {MotionTimeline} timeline\n */\nvar disposeUpdateLoop = function(timeline)\n{\n\tvar timelineIndex = timelineList.indexOf(timeline);\n\tif (timelineIndex > -1)\n\t{\n\t\tTimerTools.clearInterval(updateHandleList[timelineIndex]);\n\t\ttimelineList.splice(timelineIndex, 1);\n\t\tupdateHandleList.splice(timelineIndex, 1);\n\t}\n};\n\nvar TimelineBuilder = {\n\n\t/**\n\t * @param {RobotInfo} robotInfo - kinematics/config info\n\t * @param cb - callback to receive the newly-created Timeline instance\n\t * @param {number} [updateIntervalMillis] - timeline will auto-update with the given delay\n\t *\n\t * @return {MotionTimeline} the newly-created Timeline instance\n\t */\n\tcreateTimeline: function(robotInfo, cb, updateIntervalMillis)\n\t{\n\t\tupdateIntervalMillis = (updateIntervalMillis !== undefined) ? updateIntervalMillis : 20;\n\n\t\t// create motion timeline\n\t\tvar layerCombiner = new SimpleLayerCombiner();\n\t\tvar motionTimeline = new MotionTimeline(\"Motion Timeline\", robotInfo, Clock, layerCombiner, animate.MODALITY_NAME);\n\n\t\t// configure default layer\n\t\tmotionTimeline.createLayer(\"default\");\n\n\t\t// configure lookat layer\n\t\tmotionTimeline.createLayer(\"lookat\", [robotInfo.getDOFSet(\"BODY\").getDOFs()[0]]);\n\t\tlayerCombiner.setSampleCombiner(\"lookat\", new AddSampleCombiner());\n\n\t\t// configure additive posture layer\n\t\tmotionTimeline.createLayer(\"posture\", robotInfo.getDOFSet(\"BODY\").plus(\"EYE_ROOT\").plus(\"OVERLAY_ROOT\").getDOFs());\n\t\tlayerCombiner.setSampleCombiner(\"posture\", new AddSampleCombiner());\n\n\t\t// configure additive beat layer\n\t\tvar additiveDOFSet = robotInfo.getDOFSet(\"BODY\").plus(\"EYE_ROOT\").plus(\"OVERLAY_ROOT\");\n\t\tvar deformerDOFSet = robotInfo.getDOFSet(\"EYE_DEFORM\").plus(\"OVERLAY_DEFORM\");\n\t\tmotionTimeline.createLayer(\"beat\", additiveDOFSet.plus(deformerDOFSet).getDOFs());\n\t\tvar beatCombiner = new MixedSampleCombiner();\n\t\tbeatCombiner.addCombiner(additiveDOFSet.getDOFs(), new AddSampleCombiner());\n\t\tvar scaleCombiner = new ScaleSampleCombiner(robotInfo.getKinematicInfo().getDefaultPose().getCopy(), null, deformerDOFSet.getDOFs());\n\t\tbeatCombiner.addCombiner(deformerDOFSet.getDOFs(), scaleCombiner);\n\t\tlayerCombiner.setSampleCombiner(\"beat\", beatCombiner);\n\n\t\t// configure blink layer\n\t\tvar blinkDOFs = robotInfo.getDOFSet(\"EYE_DEFORM\").getDOFs();\n\t\tmotionTimeline.createLayer(\"blink\", blinkDOFs);\n\t\tvar blinkCombiner = new ScaleSampleCombiner(robotInfo.getKinematicInfo().getDefaultPose().getCopy(), null, blinkDOFs);\n\t\tlayerCombiner.setSampleCombiner(\"blink\", blinkCombiner);\n\n\t\t// add renderer output\n\t\tvar rendererOutput = new RendererOutput(Clock);\n\t\trendererOutput.setKinematicInfo(robotInfo.getKinematicInfo());\n\t\tmotionTimeline.addOutput(rendererOutput);\n\n\t\t// create the update loop\n\t\tvar updateList = [motionTimeline, rendererOutput];\n\t\tcreateUpdateLoop(motionTimeline, updateIntervalMillis, updateList);\n\n\t\tif (cb)\n\t\t{\n\t\t\tcb(motionTimeline);\n\t\t}\n\n\t\treturn motionTimeline;\n\t},\n\n\t/**\n\t * connect a WebGL renderer to the timeline\n\t * @param {MotionTimeline} timeline\n\t * @param {RobotRenderer} renderer\n\t */\n\tconnectRenderer: function(timeline, renderer)\n\t{\n\t\tvar outputs = timeline.getOutputs();\n\t\tfor (var i=0; i<outputs.length; i++)\n\t\t{\n\t\t\tif (outputs[i] instanceof RendererOutput)\n\t\t\t{\n\t\t\t\toutputs[i].addRenderer(renderer);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * disconnect a WebGL renderer from the timeline\n\t * @param {MotionTimeline} timeline\n\t * @param {RobotRenderer} renderer\n\t */\n\tdisconnectRenderer: function(timeline, renderer)\n\t{\n\t\tvar outputs = timeline.getOutputs();\n\t\tfor (var i=0; i<outputs.length; i++)\n\t\t{\n\t\t\tif (outputs[i] instanceof RendererOutput)\n\t\t\t{\n\t\t\t\toutputs[i].removeRenderer(renderer);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * dispose the timeline and stop all timeline-related computation.\n\t * optionally, dispose of all timeline outputs as well.\n\t * @param {MotionTimeline} timeline\n\t * @param {boolean} disposeOutputs - if true, dispose of all installed timeline outputs\n\t */\n\tdisposeTimeline: function(timeline, disposeOutputs)\n\t{\n\t\tdisposeUpdateLoop(timeline);\n\n\t\tif (disposeOutputs === true)\n\t\t{\n\t\t\tvar outputs = timeline.getOutputs();\n\t\t\tfor (var i=0; i<outputs.length; i++)\n\t\t\t{\n\t\t\t\tif (outputs[i].dispose !== undefined)\n\t\t\t\t{\n\t\t\t\t\toutputs[i].dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n};\n\nmodule.exports = TimelineBuilder;\n"],"sourceRoot":"/source/"}