/**
 * @author mattb
 */

"use strict";

var Time = require("../ifr-core/Time");
var FileTools = require("../ifr-core/FileTools");

var MotionLog = {};

/**
 * @param {string} filename
 * @return {Function}
 */
MotionLog.createLog = function (filename) {
	var fs = "fs";
	fs = require(fs);
	var motionStream = fs.createWriteStream(filename);
	var first = true;
	return function (info) {
		if (first) {
			first = false;
		} else {
			motionStream.write(",\n");
		}
		motionStream.write(JSON.stringify(info));
	};
};

/**
 * @param {string} filename
 * @param {Function} cb
 */
MotionLog.loadLog = function (filename, cb) {
	FileTools.loadText(filename, function (error, data) {
		if (error) {
			cb(error, null);
		} else {
			var infoArray = null;
			try {
				var infoString = "[" + data + "]";
				infoArray = JSON.parse(infoString);
				for (var i = 0; i < infoArray.length; i++) {
					infoArray[i].timestamp = Time.createFromTimestamp(infoArray[i].timestamp._timestamp);
				}
			} catch (e) {
				cb(e, null);
			}

			cb(null, infoArray);
		}
	});
};

module.exports = MotionLog;
//# sourceMappingURL=../map/animation-body/MotionLog.js.map
