{"version":3,"sources":["bt/Behavior.ts"],"names":[],"mappings":"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","file":"bt/Behavior.js","sourcesContent":["import Status from './Status';\nimport BaseElement from './BaseElement';\nimport ParentBehavior from \"./ParentBehavior\";\nimport Decorator from './Decorator';\n\n/**\n * @class Behavior\n * @memberof module:jibo/bt\n * @description The baseclass to all behaviors.\n *\n * Subclasses: {@link module:jibo/bt/behaviors.ExecuteScript|ExecuteScript}, {@link module:jibo/bt/behaviors.ExecuteScriptAsync|ExecuteScriptAsync}, {@link module:jibo/bt/behaviors.Null|Null}, {@link module:jibo/bt/behaviors.TimeoutJs|TimeoutJs}, \n * {@link module:jibo/bt/behaviors.Blink|Blink}, {@link module:jibo/bt/behaviors.Listen|Listen}, {@link module:jibo/bt/behaviors.ListenJs|ListenJs}, {@link module:jibo/bt/behaviors.LookAt|LookAt}, {@link module:jibo/bt/behaviors.PlayAnimation|PlayAnimation},\n * {@link module:jibo/bt/behaviors.PlayAudio|PlayAudio}, {@link module:jibo/bt/behaviors.ReadBarcode|ReadBarcode}, {@link module:jibo/bt/behaviors.Subtree|Subtree}, {@link module:jibo/bt/behaviors.SubtreeJs|SubtreeJs}, {@link module:jibo/bt/behaviors.TakePhoto|TakePhoto}, \n * {@link module:jibo/bt/behaviors.TextToSpeech|TextToSpeech}, {@link module:jibo/bt/behaviors.TextToSpeechJs|TextToSpeechJs}, {@link module:jibo/bt.ParentBehavior|ParentBehavior}\n *\n * @constructor\n * @param {Object} [options] Options for the behavior \n * @param {String} [options.name=''] Name of the behavior instance\n * @param {Array<module:jibo/bt.Decorator>} [options.decorators=[]] Decorators\n * @param {module:jibo/bt.Blackboard} [options.blackboard=null] Blackobard instance\n * @param {module:jibo/bt.BehaviorEmitter} [options.emitter=null] Emitter instance\n * @param {String} [options.assetPack=''] Name of the asset pack\n * @param {Object} [defaultOptions] Defaults for options\n */\nabstract class Behavior extends BaseElement {\n    parent:ParentBehavior;\n    waitDecorators:Array<Decorator>;\n    waitDecoratorsLength:number;\n    _decorators:Array<Decorator>;\n    previousStatus:Status;\n\n    constructor(options:any, defaultOptions:any={}){\n        super(options, Object.assign({\n            decorators: []\n        }, defaultOptions || {}));\n\n        // Set the decorators\n        this.decorators = this.options.decorators;\n\n        /**\n         * Reference to the composite parent behavior\n         * @name module:jibo/bt.Behavior~parent\n         * @type {module:jibo/bt.ParentBehavior} \n         * @readOnly\n         */\n        this.parent = null;\n\n        /** \n         * List of decorators to wait on start\n         * @name module:jibo/bt.Behavior~waitDecorators\n         * @type {Array<module:jibo/bt.Decorator>} \n         * @private\n         */\n        this.waitDecorators = [];\n\n        /** \n         * Number of wait decorators\n         * @name module:jibo/bt.Behavior~waitDecoratorsLength\n         * @type {int}\n         * @private\n         */\n        this.waitDecoratorsLength = 0;\n    }\n\n    /**\n     * Collection of decorators\n     * @name module:jibo/bt.Behavior~decorators\n     * @type {Array<module:jibo/bt.Decorator>}\n     * @readOnly\n     */\n    get decorators():Array<Decorator> { return this._decorators; }\n    set decorators(decorators:Array<Decorator>) {\n        this._decorators = decorators;\n        decorators.forEach((decorator:Decorator) => {\n            decorator.behavior = this;\n        });\n    }\n\n    /**\n     * Called every frame. Must be overridden in subclass.\n     * @method module:jibo/bt.Behavior~update\n     * @returns {module:jibo/bt.Status} The current status of this behavior.\n     */\n    abstract update():Status;\n\n    /**\n     * Internal pause the behavior\n     * @method module:jibo/bt.Behavior~_pause\n     * @private\n     */\n    _pause():void {\n        this.previousStatus = this._status;\n        this._status = Status.PAUSED;\n    }\n\n    /**\n     * Internal unpause the behavior\n     * @method module:jibo/bt.Behavior~_unpause\n     * @private\n     */\n    _unpause():void {\n        this._status = this.previousStatus;\n    }\n\n    /**\n     * Internal start the behavior\n     * @method module:jibo/bt.Behavior~_start\n     * @private\n     * @return {Boolean} Status result\n     */\n    _start():boolean {\n        if (this._status === Status.IN_PROGRESS) {\n            return false;\n        }\n\n        this.waitDecorators.length = this.waitDecoratorsLength = 0;\n        if (this._decorators.length) {\n            for(let i = 0; i < this._decorators.length; i++) {\n                let success:any = this._decorators[i]._start();\n                if (success === Status.WAIT) {\n                    this.waitDecorators.push(this._decorators[i]);\n                    this.waitDecoratorsLength++;\n                }\n                else if (!success) {\n                    this._status = Status.FAILED;\n                    this._stop();\n                    return false;\n                }\n            }\n        }\n        if (this.waitDecorators.length === 0) {\n            let success:any = this.start(); // actually call start\n            this._status = success ? Status.IN_PROGRESS : Status.FAILED;\n            if (!success) {\n                this._stop();\n            }\n            return success;\n        }\n        else {\n            this._status = Status.IN_PROGRESS;\n            return true;\n        }\n    }\n\n    /**\n     * Internal stop the behavior\n     * @method module:jibo/bt.Behavior~_stop\n     * @private\n     */\n    _stop():void {\n        //stop the decorators\n        if (this._decorators.length) {\n            this._decorators.forEach(function(decorator) {\n                if (decorator._status === Status.IN_PROGRESS) {\n                    decorator._stop();\n                }\n            });\n        }\n\n        if (this._status === Status.IN_PROGRESS) {\n            this._status = Status.INTERRUPTED;\n            this.stop(); // actually call stop\n        }\n    }\n\n    /**\n     * Internal update the behavior\n     * @method module:jibo/bt.Behavior~_update\n     * @private\n     * @return {module:jibo/bt.Status} Resulting status\n     */\n    _update():Status {\n        if (this.waitDecoratorsLength > 0) {\n            for(let i = 0; i < this.waitDecorators.length; i++) {\n                if (this.waitDecorators[i]) {\n                    let status:Status = this.waitDecorators[i]._update(this._status);\n                    if (status !== Status.WAIT) {\n                        this.waitDecoratorsLength--;\n                        this.waitDecorators[i] = null;\n                    }\n                }\n            }\n            if (this.waitDecoratorsLength === 0) {\n                let success:boolean = this.start(); // actually call start\n                this._status = success ? Status.IN_PROGRESS : Status.FAILED;\n                if (!success) {\n                    this._stop();\n                }\n            }\n            else {\n                return Status.IN_PROGRESS;\n            }\n        }\n        if (this._status === Status.PAUSED) {\n            let status:Status = this._status;\n            if (this._decorators.length) {\n                for(let i = 0; i < this._decorators.length; i++) {\n                    status = this._decorators[i]._update(this._status);\n                    if (status !== Status.IN_PROGRESS) {\n                        this._stop();\n                        return status;\n                    }\n                }\n            }\n            return this._status;\n        }\n        else if (this._status === Status.IN_PROGRESS) {\n            let tempStatus:Status = this.update(); // actually call update\n            if (tempStatus !== Status.IN_PROGRESS) {\n                this._status = tempStatus;\n                this._stop();\n            }\n            //update the decorators\n            if (this._decorators.length) {\n                for(let i = 0; i < this._decorators.length; i++) {\n                    tempStatus = this._decorators[i]._update(this._status);\n                    if (tempStatus !== Status.IN_PROGRESS) {\n                        this._stop();\n                        this._status = tempStatus;\n                        return this._status;\n                    }\n                }\n            }\n            return this._status;\n        }\n        else if (this._status === Status.SUCCEEDED) {\n            return Status.SUCCEEDED;\n        }\n        else {\n            return Status.FAILED;\n        }\n    }\n}\n\nexport default Behavior;\n"],"sourceRoot":"/source/"}